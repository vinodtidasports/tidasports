(()=>{"use strict";var __webpack_modules__={2:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>get_client_server_timezone_offset_hrs,u:()=>display_error});var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);function get_client_server_timezone_offset_hrs(referenceDate){if(!booking_form_params.timezone_conversion)return 0;let reference_time=moment(referenceDate);const client_offset=reference_time.utcOffset();reference_time.tz(booking_form_params.server_timezone);return(client_offset-reference_time.utcOffset())/60}function display_error(errorMessage=booking_form_params.i18n_request_failed,after="#wc-bookings-booking-form"){jquery__WEBPACK_IMPORTED_MODULE_0___default()(".woocommerce-error.wc-bookings-notice").removeClass("active");let errorMessageHTML=document.createElement("p");errorMessageHTML.setAttribute("class","woocommerce-error wc-bookings-notice active"),errorMessageHTML.setAttribute("style","display: none;"),errorMessageHTML.textContent=errorMessage,jquery__WEBPACK_IMPORTED_MODULE_0___default()(errorMessageHTML).insertAfter(after),jquery__WEBPACK_IMPORTED_MODULE_0___default()(".woocommerce-error.wc-bookings-notice.active").slideDown({complete:function(){jquery__WEBPACK_IMPORTED_MODULE_0___default()(".woocommerce-error.wc-bookings-notice:not(.active)").slideUp()}})}},428:module=>{module.exports=window.jQuery}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop);var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__),_bookings_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).ready((function($){var xhr,local_timezone=moment.tz.guess()||booking_form_params.server_timezone;function set_selected_time(block_picker,value){var submit_button=block_picker.closest("form").find(".wc-bookings-booking-form-button");if(void 0!==value){var selected_block=block_picker.find('[data-value="'+value+'"]');if(void 0!==selected_block.data("value"))block_picker.closest("div").find("input").val(value).trigger("change"),block_picker.closest("ul").find("a").removeClass("selected"),selected_block.addClass("selected"),submit_button.removeClass("disabled");else submit_button.addClass("disabled")}else submit_button.addClass("disabled")}function time_picker_reset_selected(block_picker){block_picker.closest("ul").find("a").removeClass("selected")}function show_available_time_blocks(element){var $form=$(element).closest("form"),fieldset=$(element).closest("div").find("fieldset"),block_picker=$(element).closest("div").find(".block-picker"),selected_block=block_picker.find(".selected"),year_str=fieldset.find("input.booking_date_year").val(),year=parseInt(year_str,10),month_str=fieldset.find("input.booking_date_month").val(),month=parseInt(month_str,10),day_str=fieldset.find("input.booking_date_day").val(),day=parseInt(day_str,10),date_str=year_str+"-"+month_str+"-"+day_str;if(year&&month&&day){block_picker.closest("div").find("input").val("").trigger("change"),block_picker.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),$form.find(".wc-bookings-booking-cost").html("").hide(),xhr&&xhr.abort();var form_val=$form.serialize(),server_offset=(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.f)(date_str);server_offset<0?form_val+="&get_next_day=true":server_offset>0&&(form_val+="&get_prev_day=true"),xhr=$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_get_blocks",form:form_val},success:function(code){var max_width,max_height;block_picker.html(code),max_width=0,max_height=0,$(".block-picker a").each((function(){var width=$(this).width(),height=$(this).height();width>max_width&&(max_width=width),height>max_height&&(max_height=height)})),$(".block-picker a").width(max_width),$(".block-picker a").height(max_height),function(date_str,element){if(!booking_form_params.timezone_conversion)return;const booking_duration_type=wc_bookings_booking_form.get_booking_duration_type(element),booking_duration_unit=wc_bookings_booking_form.get_booking_duration_unit(element);var from=moment.tz(date_str,local_timezone),to=moment(from),selector=".block-picker .block a";to.add(1,"days"),"customer"===booking_duration_type&&["hour","minute"].includes(booking_duration_unit)&&(selector=".block-picker #wc-bookings-form-start-time > option");$(selector).each((function(){if(".block-picker #wc-bookings-form-start-time > option"===selector)var block_time=$(this).val();else block_time=$(this).attr("data-value");if(void 0===block_time||"0"==block_time)return!0;var server_offset=(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.f)(date_str),server_local_time=moment.tz(block_time,booking_form_params.server_timezone),client_local_time=moment.tz(block_time,booking_form_params.server_timezone);if(client_local_time.add(server_offset,"hours"),server_local_time.isBetween(from,to,null,"[)")){if(".block-picker #wc-bookings-form-start-time > option"===selector){moment($(this).val()).unix()<=moment().unix()?$(this).remove():$(this).text(server_local_time)}$(this).text(client_local_time.format(booking_form_params.server_time_format)),$(this).data("remaining")&&(".block-picker #wc-bookings-form-start-time > option"===selector?$(this).append(" ("+$(this).data("remaining")+")"):$(this).append(' <small class="booking-spaces-left">('+$(this).data("remaining")+")</small>"))}else".block-picker #wc-bookings-form-start-time > option"===selector?$(this).remove():$(this).parent().remove()}))}(date_str,$(element)),block_picker.closest("div").unblock(),set_selected_time(block_picker,selected_block.data("value")),$(".woocommerce-error.wc-bookings-notice").slideUp()},error:function(jqXHR,exception){"abort"!==exception&&((0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.u)(),$(".blockOverlay").remove(),wc_bookings_booking_form.wc_bookings_date_picker.clear_selection(),wc_bookings_booking_form.wc_bookings_date_picker.refresh_datepicker())},dataType:"html"})}}booking_form_params.timezone_conversion&&($(".wc-bookings-date-picker-timezone").text(local_timezone.replace("_"," ")),$('[name="wc_bookings_field_start_date_local_timezone"]').val(local_timezone)),$(".block-picker").on("click","a",(function(){if($(this).closest("form").find('[name="wc_bookings_field_start_date_yearmonth"]').length)return!1;var value=$(this).data("value");return set_selected_time($(this).closest("ul"),value),!1})),wc_bookings_booking_form.time_picker_reset_selected=time_picker_reset_selected,$(".wc-bookings-booking-form").on("change","#wc-bookings-form-start-time",(function(){var value=$(this).val(),bookingForm=$(this).closest("form"),id=$(this).parents(".wc-bookings-start-time-container").data("productId"),blocks=$(this).parents(".wc-bookings-start-time-container").data("blocks"),formField=$(this).parents(".form-field").eq(0);if($("#wc-bookings-form-end-time").attr("disabled","disabled"),$("#wc-bookings-form-end-time").css("opacity","0.5"),$(this).closest("form").find(".wc-bookings-booking-cost").html("").hide(),"0"===value)return $(this).closest("form").find(".wc-bookings-booking-form-button").addClass("disabled"),!1;bookingForm.find(".wc-bookings-booking-form-button").addClass("disabled");var resource_id=bookingForm.find("#wc_bookings_field_resource").val(),year_str=bookingForm.find("input.booking_date_year").val(),year=parseInt(year_str,10),month_str=bookingForm.find("input.booking_date_month").val(),month=parseInt(month_str,10),day_str=bookingForm.find("input.booking_date_day").val(),day=parseInt(day_str,10),person_qty=bookingForm.find("#wc_bookings_field_persons").val(),date_str=year_str+"-"+month_str+"-"+day_str;return year&&month&&day?(xhr=$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_get_end_time_html",security:booking_form_params.nonce.get_end_time_html,start_date_time:value,product_id:id,blocks,resource_id,person_qty},success:function(response){bookingForm.find(".wc-bookings-end-time-container").replaceWith(response),function(date_str){if(!booking_form_params.timezone_conversion)return;var from=moment.tz(date_str,local_timezone),to=moment(from),element=".block-picker #wc-bookings-form-end-time > option";to.add(1,"days"),$(element).each((function(){var block_time=$(this).data("value");if(void 0===block_time||"0"==block_time)return!0;var server_offset=(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.f)(date_str),client_local_time=moment.tz(block_time,booking_form_params.server_timezone),duration_display=$(this).data("durationDisplay");client_local_time.add(server_offset,"hours"),$(this).text(client_local_time.format(booking_form_params.server_time_format)+duration_display)}))}(date_str),formField.find("input.required_for_calculation").val(value)},dataType:"html"}),!1):void 0})),$(".wc-bookings-booking-form").on("change","#wc-bookings-form-end-time",(function(){$(".wc-bookings-booking-cost").html("").hide();var value=$(this).val(),block_picker=$(this);$(this).parents(".wc-bookings-booking-form").find(".wc_bookings_field_duration").val(value);var submit_button=block_picker.closest("form").find(".wc-bookings-booking-form-button");void 0!==value&&"0"!==value&&"0"!==$(this).parents(".wc-bookings-booking-form").find("#wc-bookings-form-start-time").val()?(block_picker.parents(".form-field").eq(0).find("input.required_for_calculation").trigger("change"),submit_button.removeClass("disabled")):submit_button.addClass("disabled")})),$(".wc_bookings_field_duration").on("change",(function(){["hour","minute"].includes(wc_bookings_booking_form.get_booking_duration_unit($(this)))&&show_available_time_blocks(this)})),$("#wc_bookings_field_resource").on("change",(function(){const duration_unit=wc_bookings_booking_form.get_booking_duration_unit($(this));if("month"===duration_unit)!function(element){var form_val=$(element).closest("form").serialize(),block_picker=$(element).closest("div").find(".block-picker");block_picker.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show();$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_get_booking_blocks",form:form_val,security:booking_form_params.nonce.show_available_month_blocks},success:function(result){if(!(result=JSON.parse(result)).success)return alert(result.data),!1;block_picker.closest("div").unblock(),$(".block-picker").html(result.data)},error:function(jqXHR,exception){"abort"!==exception&&(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.u)()},dataType:"html"})}(this);else if(!["hour","minute"].includes(duration_unit))return;time_picker_reset_selected($(".wc-bookings-booking-form").find(".block-picker"))})),$(".wc-bookings-booking-form fieldset").on("date-selected",(function(){$(".wc_bookings_field_duration").val(1),["hour","minute"].includes(wc_bookings_booking_form.get_booking_duration_unit($(this)))&&show_available_time_blocks(this)}))}))})();
//# sourceMappingURL=admin-time-picker.js.map