(()=>{"use strict";var __webpack_require__={n:module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},d:(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},o:(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop)};const external_React_namespaceObject=window.React,external_wp_element_namespaceObject=window.wp.element,external_lodash_namespaceObject=window.lodash,external_wp_components_namespaceObject=window.wp.components,external_moment_namespaceObject=window.moment;var external_moment_default=__webpack_require__.n(external_moment_namespaceObject);class DatePickerPopoverMonth extends external_wp_element_namespaceObject.Component{constructor(props){super(props),this.state={showPicker:!1},this.handleChange=this.handleChange.bind(this);const picker=this;document.addEventListener("click",(function(event){let element=document.getElementById("wc-bookings-datepicker-toggle-month");event.target===element||element.contains(event.target)||event.target.closest(".wc-bookings-datepicker-popover")||picker.setState({showPicker:!1})}))}handleChange(datetime){const date=datetime.substring(0,10);document.location.search+="&calendar_day="+date+"&view=day"}toggleVisibility(){const{showPicker}=this.state;this.setState({showPicker:!showPicker})}render(){const{showPicker}=this.state,{year,month}=this.props;return(0,external_React_namespaceObject.createElement)("div",null,(0,external_React_namespaceObject.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),this.toggleVisibility()},id:"wc-bookings-datepicker-toggle-month"},month," ",year," ",(0,external_React_namespaceObject.createElement)("span",null," ▾")),showPicker&&(0,external_React_namespaceObject.createElement)(external_wp_components_namespaceObject.Popover,{className:"wc-bookings-datepicker-popover"},(0,external_React_namespaceObject.createElement)(external_wp_components_namespaceObject.DateTimePicker,{onChange:this.handleChange,currentDate:external_moment_default()("01 "+month+" "+year,"DD MMM YYYY").toDate(),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})))}}const datepicker_popover_month=DatePickerPopoverMonth;class DatePickerPopoverDay extends external_wp_element_namespaceObject.Component{constructor(props){super(props),this.state={showPicker:!1},this.handleChange=this.handleChange.bind(this);const picker=this;document.addEventListener("click",(function(event){let element=document.getElementById("wc-bookings-datepicker-toggle-day");event.target===element||element.contains(event.target)||event.target.closest(".wc-bookings-datepicker-popover")||picker.setState({showPicker:!1})}))}handleChange(datetime){const date=datetime.substring(0,10);document.location.search+="&calendar_day="+date+"&view=day"}toggleVisibility(){const{showPicker}=this.state;this.setState({showPicker:!showPicker})}render(){const{showPicker}=this.state,{year,month,day}=this.props;return(0,external_React_namespaceObject.createElement)("div",null,(0,external_React_namespaceObject.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),this.toggleVisibility()},id:"wc-bookings-datepicker-toggle-day"},day," ",(0,external_React_namespaceObject.createElement)("span",null," ▾")),showPicker&&(0,external_React_namespaceObject.createElement)(external_wp_components_namespaceObject.Popover,{className:"wc-bookings-datepicker-popover"},(0,external_React_namespaceObject.createElement)(external_wp_components_namespaceObject.DateTimePicker,{onChange:this.handleChange,currentDate:external_moment_default()(Date.parse(day)).toDate(),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})))}}const datepicker_popover_day=DatePickerPopoverDay,external_wp_i18n_namespaceObject=window.wp.i18n;class BookingDetails extends external_wp_element_namespaceObject.Component{render(){const{booking}=this.props,{orderMeta}=booking;let parsedOrderMeta=[];return orderMeta&&(parsedOrderMeta=JSON.parse(orderMeta)),(0,external_React_namespaceObject.createElement)(external_wp_element_namespaceObject.Fragment,null,(0,external_React_namespaceObject.createElement)("div",null,(0,external_React_namespaceObject.createElement)("div",{id:"event_detail_header"},(0,external_React_namespaceObject.createElement)("h3",null,booking.title)),(0,external_React_namespaceObject.createElement)("div",{id:"event_detail_body"},(0,external_React_namespaceObject.createElement)("div",{id:"booking_status"},booking.status&&(0,external_React_namespaceObject.createElement)("span",null,booking.status)),(0,external_React_namespaceObject.createElement)("ul",null,booking.date&&booking.time&&(0,external_React_namespaceObject.createElement)("li",{className:"daily_popover_datetime_icon"},(0,external_React_namespaceObject.createElement)("span",null,(0,external_React_namespaceObject.createElement)("strong",null,booking.date,(0,external_React_namespaceObject.createElement)("br",null),booking.time))),booking.customer&&(0,external_React_namespaceObject.createElement)("li",{className:"daily_popover_customer_icon"},(0,external_React_namespaceObject.createElement)("span",null,(0,external_React_namespaceObject.createElement)("strong",null,wc_bookings_admin_js_params.i18n_customer),booking.customer)),booking.resource&&(0,external_React_namespaceObject.createElement)("li",{className:"daily_popover_resource_icon"},(0,external_React_namespaceObject.createElement)("span",null,(0,external_React_namespaceObject.createElement)("strong",null,wc_bookings_admin_js_params.i18n_resource),booking.resource.split(",").join("<br />"))),booking.persons&&(0,external_React_namespaceObject.createElement)("li",{className:"daily_popover_persons_icon"},(0,external_React_namespaceObject.createElement)("span",null,(0,external_React_namespaceObject.createElement)("strong",null,wc_bookings_admin_js_params.i18n_persons),booking.persons)),parsedOrderMeta.map((({attrs,title},index)=>(0,external_React_namespaceObject.createElement)(external_wp_element_namespaceObject.Fragment,null,(0,external_React_namespaceObject.createElement)("li",{class:"daily_popover_group_title"},(0,external_React_namespaceObject.createElement)("strong",null,title)),Object.keys(attrs).map((metaKey=>(0,external_React_namespaceObject.createElement)("li",{className:"daily_popover_order_meta_item",dangerouslySetInnerHTML:{__html:`<strong>${metaKey}</strong>${attrs[metaKey]}`}})))))))),booking.url&&(0,external_React_namespaceObject.createElement)("div",{id:"event_detail_footer"},(0,external_React_namespaceObject.createElement)("a",{href:booking.url},wc_bookings_admin_js_params.i18n_view_details)," ",(0,external_React_namespaceObject.createElement)("span",null,"→"))))}}class CalendarPopover extends external_wp_element_namespaceObject.Component{constructor(props){super(props),this.state={showPicker:!1}}getBookingData(){const attrs=this.props.element.attributes;let booking={};return Object.entries({"data-id":"id","data-status":"status","data-booking-title":"title","data-booking-url":"url","data-booking-date":"date","data-booking-time":"time","data-booking-customer":"customer","data-booking-resource":"resource","data-booking-persons":"persons","data-order-meta":"orderMeta"}).forEach((([attrName,propName])=>{booking[propName]=attrs.getNamedItem(attrName)?attrs.getNamedItem(attrName).value:""})),booking.url=booking.url?booking.url.trim():"",/^https?:\/\/[^\s'"<>]+$/gi.test(booking.url)||(booking.url=""),booking}toggleVisibility=e=>{e.preventDefault();const{showPicker}=this.state;this.setState({showPicker:!showPicker})};closePopover=()=>{this.setState({showPicker:!1})};parseStyles=styles=>styles.split(";").filter((style=>style.split(":")[0]&&style.split(":")[1])).map((style=>[style.split(":")[0].trim().replace(/-./g,(c=>c.substr(1).toUpperCase())),style.split(":")[1].trim()])).reduce(((styleObj,style)=>({...styleObj,[style[0]]:style[1]})),{});render(){const{showPicker}=this.state,{getAnchorRect,position}=this.props,attr=this.props.element.attributes,classes=attr.getNamedItem("data-classes")?attr.getNamedItem("data-classes").value:"",styles=attr.getNamedItem("data-style")?this.parseStyles(attr.getNamedItem("data-style").value):{},booking=this.getBookingData();return(0,external_React_namespaceObject.createElement)(external_wp_element_namespaceObject.Fragment,null,(0,external_React_namespaceObject.createElement)("a",{href:booking.url,className:classes,style:styles,onClick:this.toggleVisibility},(0,external_React_namespaceObject.createElement)("span",{className:"booking-calendar-booking-title"},booking.customer+(booking.customer?", ":"")+booking.title),(0,external_React_namespaceObject.createElement)("span",{className:"booking-calendar-time-range"},booking.time)),showPicker&&(0,external_React_namespaceObject.createElement)(external_wp_components_namespaceObject.Popover,{className:"wc-bookings-calendar-popover",focusOnMount:"firstElement",getAnchorRect,position,onFocusOutside:this.closePopover},(0,external_React_namespaceObject.createElement)(external_wp_components_namespaceObject.Button,{className:"wc-bookings-calendar-popover-close",onClick:this.closePopover},(0,external_wp_i18n_namespaceObject.__)("Close","woocommerce-bookings")),(0,external_React_namespaceObject.createElement)(BookingDetails,{booking})))}}const calendar_popover=CalendarPopover,{default_month,default_year,default_day}=wc_bookings_admin_calendar_js_params,popoverContainerMonth=document.getElementById("wc-bookings-datepicker-container-month");if(null!==popoverContainerMonth){const pickerMonth=(0,external_React_namespaceObject.createElement)(datepicker_popover_month,{year:default_year,month:default_month});(0,external_wp_element_namespaceObject.render)(pickerMonth,popoverContainerMonth)}const popoverContainerDay=document.getElementById("wc-bookings-datepicker-container-day");if(null!==popoverContainerDay){const pickerDay=(0,external_React_namespaceObject.createElement)(datepicker_popover_day,{year:default_year,month:default_month,day:default_day});(0,external_wp_element_namespaceObject.render)(pickerDay,popoverContainerDay)}const calendarEventMonth=document.getElementsByClassName("calendar_month_event");null!==calendarEventMonth&&(0,external_lodash_namespaceObject.forEach)(calendarEventMonth,(function(value){var popoverElement;(0,external_wp_element_namespaceObject.render)((0,external_React_namespaceObject.createElement)(calendar_popover,{getAnchorRect:(popoverElement=value,popoverAnchorElement=>{popoverAnchorElement&&"A"===popoverAnchorElement.tagName||(popoverAnchorElement=popoverElement.querySelector(".wc-bookings-event-link"));const td=popoverElement.closest("td"),tableRect=popoverElement.closest("table").getBoundingClientRect(),content=popoverElement.querySelector(".components-popover__content")||popoverElement,anchorRect=popoverAnchorElement.getBoundingClientRect(),anchorPoint={x:anchorRect.x+td.clientWidth/2,y:anchorRect.y};let x=anchorPoint.x;anchorPoint.x+content.clientWidth>tableRect.width+tableRect.x&&(x=anchorPoint.x-content.clientWidth);let y=anchorPoint.y;return anchorPoint.y+content.clientHeight>document.body.clientHeight&&(y=document.body.clientHeight-content.clientHeight),new DOMRect(x,y,0,0)}),element:value,position:"bottom center"}),value)}));const calendarEventDay=document.getElementsByClassName("daily_view_booking");null!==calendarEventDay&&(0,external_lodash_namespaceObject.forEach)(calendarEventDay,(function(value){(0,external_wp_element_namespaceObject.render)((0,external_React_namespaceObject.createElement)(calendar_popover,{element:value,position:"bottom center"}),value.childNodes[0])}))})();
//# sourceMappingURL=admin-calendar-gutenberg.js.map