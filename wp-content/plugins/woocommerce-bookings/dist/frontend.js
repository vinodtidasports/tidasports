(()=>{"use strict";var _wordpress_hooks__WEBPACK_IMPORTED_MODULE_0__,jquery__WEBPACK_IMPORTED_MODULE_0__,jquery__WEBPACK_IMPORTED_MODULE_0___default,__webpack_modules__={2:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>get_client_server_timezone_offset_hrs,u:()=>display_error});var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);function get_client_server_timezone_offset_hrs(referenceDate){if(!booking_form_params.timezone_conversion)return 0;let reference_time=moment(referenceDate);const client_offset=reference_time.utcOffset();reference_time.tz(booking_form_params.server_timezone);return(client_offset-reference_time.utcOffset())/60}function display_error(errorMessage=booking_form_params.i18n_request_failed,after="#wc-bookings-booking-form"){jquery__WEBPACK_IMPORTED_MODULE_0___default()(".woocommerce-error.wc-bookings-notice").removeClass("active");let errorMessageHTML=document.createElement("p");errorMessageHTML.setAttribute("class","woocommerce-error wc-bookings-notice active"),errorMessageHTML.setAttribute("style","display: none;"),errorMessageHTML.textContent=errorMessage,jquery__WEBPACK_IMPORTED_MODULE_0___default()(errorMessageHTML).insertAfter(after),jquery__WEBPACK_IMPORTED_MODULE_0___default()(".woocommerce-error.wc-bookings-notice.active").slideDown({complete:function(){jquery__WEBPACK_IMPORTED_MODULE_0___default()(".woocommerce-error.wc-bookings-notice:not(.active)").slideUp()}})}},771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>HookApi});__webpack_require__(619);const HookApi=()=>window.wc_bookings.hooks},428:module=>{module.exports=window.jQuery},619:module=>{module.exports=window.wp.hooks}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),_wordpress_hooks__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(619),window.wc_bookings=window.wc_bookings||{},window.wc_bookings.hooks=(0,_wordpress_hooks__WEBPACK_IMPORTED_MODULE_0__.createHooks)(),jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428),(jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__))()(document).ready((function($){wc_bookings_booking_form.is_multiple_booking_forms_exist=()=>!!$(".wc-bookings-booking-form").closest("form").length,wc_bookings_booking_form.get_booking_product_id=element=>{let form=element.closest("form");return form=element instanceof jquery__WEBPACK_IMPORTED_MODULE_0___default()?form.get(0):form,parseInt(form.querySelector(".wc-booking-product-id").value)},wc_bookings_booking_form.get_booking_duration=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].booking_duration):window.wc_bookings_booking_form.booking_duration},wc_bookings_booking_form.get_booking_duration_type=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].duration_type):window.wc_bookings_booking_form.booking_duration_type},wc_bookings_booking_form.get_booking_max_duration=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].booking_max_duration):window.wc_bookings_booking_form.booking_max_duration},wc_bookings_booking_form.get_booking_min_duration=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].booking_min_duration):window.wc_bookings_booking_form.booking_min_duration},wc_bookings_booking_form.get_booking_check_availability_against=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].check_availability_against):window.wc_bookings_booking_form.check_availability_against},wc_bookings_booking_form.get_booking_default_availability=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].default_availability):window.wc_bookings_booking_form.default_availability},wc_bookings_booking_form.get_booking_duration_unit=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].duration_unit):window.wc_bookings_booking_form.duration_unit},wc_bookings_booking_form.get_booking_resources_assignment=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].resources_assignment):window.wc_bookings_booking_form.resources_assignment},wc_bookings_booking_form.get_booking_resource_ids=element=>{let product_id=null;return wc_bookings_booking_form.is_multiple_booking_forms_exist()?(product_id=wc_bookings_booking_form.get_booking_product_id(element),window[`wc_bookings_booking_form_${product_id}`].resource_ids):window.wc_bookings_booking_form.resource_ids},wc_bookings_booking_form.sanitize_text=text=>{const element=document.createElement("div");return element.innerText=text,element.innerHTML}})),(()=>{var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__),_bookings_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(771);jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).ready((function($){window.console||(window.console={log:function(){}});let xhr=[];wc_bookings_booking_form.wc_booking_form=$(".wc-bookings-booking-form").closest("form"),$(".wc-bookings-booking-form").on("change",'input, select:not("#wc-bookings-form-start-time, #wc-bookings-form-end-time")',(function(e){var name=$(this).attr("name");const booking_duration_type=wc_bookings_booking_form.get_booking_duration_type($(this)),booking_duration_unit=wc_bookings_booking_form.get_booking_duration_unit($(this)),$form=$(this).closest("form");if((0,_utils__WEBPACK_IMPORTED_MODULE_2__.A)().doAction("wc_bookings_form_field_change",{field:$(this).get(0)}),"wc_bookings_field_resource"===name)return wc_bookings_booking_form.wc_bookings_date_picker.clear_selection(),void wc_bookings_booking_form.wc_bookings_date_picker.init();if("wc_bookings_field_start_date_day"===name&&["hour","minute"].includes(booking_duration_unit))return;if("customer"===booking_duration_type&&"0"===$form.find("#wc-bookings-form-start-time").val())return;if("customer"===booking_duration_type&&"0"===$form.find("#wc-bookings-form-end-time").val())return;let $fieldset=$form.find("fieldset"),$picker=$fieldset.find(".picker:eq(0)");if($picker.data("is_range_picker_enabled")&&"wc_bookings_field_duration"!==name&&-1===name.indexOf("wc_bookings_field_persons"))return;let index=$form.index(this),isEmptyCalendarSelection=!$form.find("[name='wc_bookings_field_start_date_day']").val()&&!$form.find("#wc_bookings_field_start_date").val();if(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).hasClass("addon")&&isEmptyCalendarSelection)return;let required_fields=$form.find("input.required_for_calculation"),filled=!0;$.each(required_fields,(function(index,field){$(field).val()||(filled=!1)})),filled?((0,_utils__WEBPACK_IMPORTED_MODULE_2__.A)().doAction("wc_bookings_pre_calculte_booking_cost",{field:$(this).get(0),fieldset:$fieldset.get(0),date_picker:$picker.get(0),form:$form.get(0)}),$form.find(".wc-bookings-booking-cost").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),xhr[index]=$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_calculate_costs",form:$form.serialize()},success:function(code){"{"!==code.charAt(0)&&(console.log(code),code="{"+code.split(/\{(.+)?/)[1]);let result=JSON.parse(code);"ERROR"===result.result?($form.find(".wc-bookings-booking-cost").html(result.html),$form.find(".wc-bookings-booking-cost").unblock(),$form.find(".wc-bookings-booking-cost").show(),$form.find(".single_add_to_cart_button").addClass("disabled")):"SUCCESS"===result.result?($form.find(".wc-bookings-booking-cost").html(result.html),$form.find(".wc-bookings-booking-cost").unblock(),$form.find(".single_add_to_cart_button").removeClass("disabled"),booking_form_params.pao_active&&"true"!==booking_form_params.pao_pre_30&&void 0!==result.raw_price&&($form.find(".wc-bookings-booking-cost").attr("data-raw-price",result.raw_price),$("form.cart").trigger("woocommerce-product-addons-update"))):($form.find(".wc-bookings-booking-cost").hide(),$form.find(".single_add_to_cart_button").addClass("disabled"),console.log(code)),$(document.body).trigger("wc_booking_form_changed",[$form]),$(".woocommerce-error.wc-bookings-notice").slideUp()},error:function(jqXHR,exception){"abort"!==exception&&((0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.u)(),$form.find(".wc-bookings-booking-cost").hide(),$form.find(".single_add_to_cart_button").addClass("disabled"),booking_form_params.pao_active&&"true"!==booking_form_params.pao_pre_30&&$("form.cart").trigger("woocommerce-product-addons-update"))},dataType:"html"})):$form.find(".wc-bookings-booking-cost").hide()})).each((function(){$(this).closest("form").find(".single_add_to_cart_button").addClass("disabled")})),$(".single_add_to_cart_button").on("click",(function(event){if($(this).hasClass("disabled"))return alert(booking_form_params.i18n_choose_options),event.preventDefault(),!1})),$(".add_custom_booking").on("click",(function(event){if(!$(".wc-bookings-booking-cost").is(":visible")||$(".wc-bookings-booking-cost .booking-error").is(":visible"))return alert(booking_form_params.i18n_choose_options),event.preventDefault(),!1})),"true"===booking_form_params.pao_pre_30&&$(".wc-bookings-booking-form").parent().on("updated_addons",(function(){$(".wc-bookings-booking-form").find("input").first().trigger("change")})),$(".wc-bookings-booking-form, .wc-bookings-booking-form-button").show().prop("disabled",!1)}))})(),(()=>{var external_jQuery_=__webpack_require__(428),external_jQuery_default=__webpack_require__.n(external_jQuery_);const external_namespaceObject=window._;var external_default=__webpack_require__.n(external_namespaceObject),bookings_lib=__webpack_require__(2),ALL_WEEKDAYS=["MO","TU","WE","TH","FR","SA","SU"],Weekday=function(){function Weekday(weekday,n){if(0===n)throw new Error("Can't create weekday with n == 0");this.weekday=weekday,this.n=n}return Weekday.fromStr=function(str){return new Weekday(ALL_WEEKDAYS.indexOf(str))},Weekday.prototype.nth=function(n){return this.n===n?this:new Weekday(this.weekday,n)},Weekday.prototype.equals=function(other){return this.weekday===other.weekday&&this.n===other.n},Weekday.prototype.toString=function(){var s=ALL_WEEKDAYS[this.weekday];return this.n&&(s=(this.n>0?"+":"")+String(this.n)+s),s},Weekday.prototype.getJsWeekday=function(){return 6===this.weekday?0:this.weekday+1},Weekday}(),isPresent=function(value){return null!=value},isNumber=function(value){return"number"==typeof value},isWeekdayStr=function(value){return"string"==typeof value&&ALL_WEEKDAYS.includes(value)},isArray=Array.isArray,range=function(start,end){void 0===end&&(end=start),1===arguments.length&&(end=start,start=0);for(var rang=[],i=start;i<end;i++)rang.push(i);return rang},repeat=function(value,times){var i=0,array=[];if(isArray(value))for(;i<times;i++)array[i]=[].concat(value);else for(;i<times;i++)array[i]=value;return array};function padStart(item,targetLength,padString){void 0===padString&&(padString=" ");var str=String(item);return targetLength|=0,str.length>targetLength?String(str):((targetLength-=str.length)>padString.length&&(padString+=repeat(padString,targetLength/padString.length)),padString.slice(0,targetLength)+String(str))}var split=function(str,sep,num){var splits=str.split(sep);return num?splits.slice(0,num).concat([splits.slice(num).join(sep)]):splits},pymod=function(a,b){var r=a%b;return r*b<0?r+b:r},divmod=function(a,b){return{div:Math.floor(a/b),mod:pymod(a,b)}},empty=function(obj){return!isPresent(obj)||0===obj.length},notEmpty=function(obj){return!empty(obj)},includes=function(arr,val){return notEmpty(arr)&&-1!==arr.indexOf(val)},datetime=function(y,m,d,h,i,s){return void 0===h&&(h=0),void 0===i&&(i=0),void 0===s&&(s=0),new Date(Date.UTC(y,m-1,d,h,i,s))},MONTH_DAYS=[31,28,31,30,31,30,31,31,30,31,30,31],MAXYEAR=9999,ORDINAL_BASE=datetime(1970,1,1),PY_WEEKDAYS=[6,0,1,2,3,4,5],isLeapYear=function(year){return year%4==0&&year%100!=0||year%400==0},isDate=function(value){return value instanceof Date},isValidDate=function(value){return isDate(value)&&!isNaN(value.getTime())},toOrdinal=function(date){return date2=ORDINAL_BASE,differencems=date.getTime()-date2.getTime(),Math.round(differencems/864e5);var date2,differencems},fromOrdinal=function(ordinal){return new Date(ORDINAL_BASE.getTime()+864e5*ordinal)},getMonthDays=function(date){var month=date.getUTCMonth();return 1===month&&isLeapYear(date.getUTCFullYear())?29:MONTH_DAYS[month]},getWeekday=function(date){return PY_WEEKDAYS[date.getUTCDay()]},monthRange=function(year,month){var date=datetime(year,month+1,1);return[getWeekday(date),getMonthDays(date)]},combine=function(date,time){return time=time||date,new Date(Date.UTC(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),time.getHours(),time.getMinutes(),time.getSeconds(),time.getMilliseconds()))},dateutil_clone=function(date){return new Date(date.getTime())},cloneDates=function(dates){for(var clones=[],i=0;i<dates.length;i++)clones.push(dateutil_clone(dates[i]));return clones},sort=function(dates){dates.sort((function(a,b){return a.getTime()-b.getTime()}))},timeToUntilString=function(time,utc){void 0===utc&&(utc=!0);var date=new Date(time);return[padStart(date.getUTCFullYear().toString(),4,"0"),padStart(date.getUTCMonth()+1,2,"0"),padStart(date.getUTCDate(),2,"0"),"T",padStart(date.getUTCHours(),2,"0"),padStart(date.getUTCMinutes(),2,"0"),padStart(date.getUTCSeconds(),2,"0"),utc?"Z":""].join("")},untilStringToDate=function(until){var bits=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/.exec(until);if(!bits)throw new Error("Invalid UNTIL value: ".concat(until));return new Date(Date.UTC(parseInt(bits[1],10),parseInt(bits[2],10)-1,parseInt(bits[3],10),parseInt(bits[5],10)||0,parseInt(bits[6],10)||0,parseInt(bits[7],10)||0))},dateTZtoISO8601=function(date,timeZone){return date.toLocaleString("sv-SE",{timeZone}).replace(" ","T")+"Z"};const iterresult=function(){function IterResult(method,args){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=method,this.args=args,"between"===method?(this.maxDate=args.inc?args.before:new Date(args.before.getTime()-1),this.minDate=args.inc?args.after:new Date(args.after.getTime()+1)):"before"===method?this.maxDate=args.inc?args.dt:new Date(args.dt.getTime()-1):"after"===method&&(this.minDate=args.inc?args.dt:new Date(args.dt.getTime()+1))}return IterResult.prototype.accept=function(date){++this.total;var tooEarly=this.minDate&&date<this.minDate,tooLate=this.maxDate&&date>this.maxDate;if("between"===this.method){if(tooEarly)return!0;if(tooLate)return!1}else if("before"===this.method){if(tooLate)return!1}else if("after"===this.method)return!!tooEarly||(this.add(date),!1);return this.add(date)},IterResult.prototype.add=function(date){return this._result.push(date),!0},IterResult.prototype.getValue=function(){var res=this._result;switch(this.method){case"all":case"between":return res;default:return res.length?res[res.length-1]:null}},IterResult.prototype.clone=function(){return new IterResult(this.method,this.args)},IterResult}();var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};Object.create;function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}Object.create;"function"==typeof SuppressedError&&SuppressedError;const callbackiterresult=function(_super){function CallbackIterResult(method,args,iterator){var _this=_super.call(this,method,args)||this;return _this.iterator=iterator,_this}return __extends(CallbackIterResult,_super),CallbackIterResult.prototype.add=function(date){return!!this.iterator(date,this._result.length)&&(this._result.push(date),!0)},CallbackIterResult}(iterresult);const i18n={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}};var contains=function(arr,val){return-1!==arr.indexOf(val)},defaultGetText=function(id){return id.toString()},defaultDateFormatter=function(year,month,day){return"".concat(month," ").concat(day,", ").concat(year)};const totext=function(){function ToText(rrule,gettext,language,dateFormatter){if(void 0===gettext&&(gettext=defaultGetText),void 0===language&&(language=i18n),void 0===dateFormatter&&(dateFormatter=defaultDateFormatter),this.text=[],this.language=language||i18n,this.gettext=gettext,this.dateFormatter=dateFormatter,this.rrule=rrule,this.options=rrule.options,this.origOptions=rrule.origOptions,this.origOptions.bymonthday){var bymonthday=[].concat(this.options.bymonthday),bynmonthday=[].concat(this.options.bynmonthday);bymonthday.sort((function(a,b){return a-b})),bynmonthday.sort((function(a,b){return b-a})),this.bymonthday=bymonthday.concat(bynmonthday),this.bymonthday.length||(this.bymonthday=null)}if(isPresent(this.origOptions.byweekday)){var byweekday=isArray(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],days=String(byweekday);this.byweekday={allWeeks:byweekday.filter((function(weekday){return!weekday.n})),someWeeks:byweekday.filter((function(weekday){return Boolean(weekday.n)})),isWeekdays:-1!==days.indexOf("MO")&&-1!==days.indexOf("TU")&&-1!==days.indexOf("WE")&&-1!==days.indexOf("TH")&&-1!==days.indexOf("FR")&&-1===days.indexOf("SA")&&-1===days.indexOf("SU"),isEveryDay:-1!==days.indexOf("MO")&&-1!==days.indexOf("TU")&&-1!==days.indexOf("WE")&&-1!==days.indexOf("TH")&&-1!==days.indexOf("FR")&&-1!==days.indexOf("SA")&&-1!==days.indexOf("SU")};var sortWeekDays=function(a,b){return a.weekday-b.weekday};this.byweekday.allWeeks.sort(sortWeekDays),this.byweekday.someWeeks.sort(sortWeekDays),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return ToText.isFullyConvertible=function(rrule){if(!(rrule.options.freq in ToText.IMPLEMENTED))return!1;if(rrule.origOptions.until&&rrule.origOptions.count)return!1;for(var key in rrule.origOptions){if(contains(["dtstart","tzid","wkst","freq"],key))return!0;if(!contains(ToText.IMPLEMENTED[rrule.options.freq],key))return!1}return!0},ToText.prototype.isFullyConvertible=function(){return ToText.isFullyConvertible(this.rrule)},ToText.prototype.toString=function(){var gettext=this.gettext;if(!(this.options.freq in ToText.IMPLEMENTED))return gettext("RRule error: Unable to fully convert this rrule to text");if(this.text=[gettext("every")],this[RRule.FREQUENCIES[this.options.freq]](),this.options.until){this.add(gettext("until"));var until=this.options.until;this.add(this.dateFormatter(until.getUTCFullYear(),this.language.monthNames[until.getUTCMonth()],until.getUTCDate()))}else this.options.count&&this.add(gettext("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?gettext("times"):gettext("time"));return this.isFullyConvertible()||this.add(gettext("(~ approximate)")),this.text.join("")},ToText.prototype.HOURLY=function(){var gettext=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?gettext("hours"):gettext("hour"))},ToText.prototype.MINUTELY=function(){var gettext=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?gettext("minutes"):gettext("minute"))},ToText.prototype.DAILY=function(){var gettext=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?gettext("weekdays"):gettext("weekday")):this.add(this.plural(this.options.interval)?gettext("days"):gettext("day")),this.origOptions.bymonth&&(this.add(gettext("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},ToText.prototype.WEEKLY=function(){var gettext=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?gettext("weeks"):gettext("week")),this.byweekday&&this.byweekday.isWeekdays?1===this.options.interval?this.add(this.plural(this.options.interval)?gettext("weekdays"):gettext("weekday")):this.add(gettext("on")).add(gettext("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?gettext("days"):gettext("day")):(1===this.options.interval&&this.add(gettext("week")),this.origOptions.bymonth&&(this.add(gettext("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},ToText.prototype.MONTHLY=function(){var gettext=this.gettext;this.origOptions.bymonth?(1!==this.options.interval&&(this.add(this.options.interval.toString()).add(gettext("months")),this.plural(this.options.interval)&&this.add(gettext("in"))),this._bymonth()):(1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?gettext("months"):gettext("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(gettext("on")).add(gettext("weekdays")):this.byweekday&&this._byweekday()},ToText.prototype.YEARLY=function(){var gettext=this.gettext;this.origOptions.bymonth?(1!==this.options.interval&&(this.add(this.options.interval.toString()),this.add(gettext("years"))),this._bymonth()):(1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?gettext("years"):gettext("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(gettext("on the")).add(this.list(this.options.byyearday,this.nth,gettext("and"))).add(gettext("day")),this.options.byweekno&&this.add(gettext("in")).add(this.plural(this.options.byweekno.length)?gettext("weeks"):gettext("week")).add(this.list(this.options.byweekno,void 0,gettext("and")))},ToText.prototype._bymonthday=function(){var gettext=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(gettext("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,gettext("or"))).add(gettext("the")).add(this.list(this.bymonthday,this.nth,gettext("or"))):this.add(gettext("on the")).add(this.list(this.bymonthday,this.nth,gettext("and")))},ToText.prototype._byweekday=function(){var gettext=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(gettext("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(gettext("and")),this.add(gettext("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,gettext("and"))))},ToText.prototype._byhour=function(){var gettext=this.gettext;this.add(gettext("at")).add(this.list(this.origOptions.byhour,void 0,gettext("and")))},ToText.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},ToText.prototype.nth=function(n){var nth;n=parseInt(n.toString(),10);var gettext=this.gettext;if(-1===n)return gettext("last");var npos=Math.abs(n);switch(npos){case 1:case 21:case 31:nth=npos+gettext("st");break;case 2:case 22:nth=npos+gettext("nd");break;case 3:case 23:nth=npos+gettext("rd");break;default:nth=npos+gettext("th")}return n<0?nth+" "+gettext("last"):nth},ToText.prototype.monthtext=function(m){return this.language.monthNames[m-1]},ToText.prototype.weekdaytext=function(wday){var weekday=isNumber(wday)?(wday+1)%7:wday.getJsWeekday();return(wday.n?this.nth(wday.n)+" ":"")+this.language.dayNames[weekday]},ToText.prototype.plural=function(n){return n%100!=1},ToText.prototype.add=function(s){return this.text.push(" "),this.text.push(s),this},ToText.prototype.list=function(arr,callback,finalDelim,delim){var _this=this;void 0===delim&&(delim=","),isArray(arr)||(arr=[arr]);callback=callback||function(o){return o.toString()};var realCallback=function(arg){return callback&&callback.call(_this,arg)};return finalDelim?function(array,delimiter,finalDelimiter){for(var list="",i=0;i<array.length;i++)0!==i&&(i===array.length-1?list+=" "+finalDelimiter+" ":list+=delimiter+" "),list+=array[i];return list}(arr.map(realCallback),delim,finalDelim):arr.map(realCallback).join(delim+" ")},ToText}();var Frequency,Parser=function(){function Parser(rules){this.done=!0,this.rules=rules}return Parser.prototype.start=function(text){return this.text=text,this.done=!1,this.nextSymbol()},Parser.prototype.isDone=function(){return this.done&&null===this.symbol},Parser.prototype.nextSymbol=function(){var best,bestSymbol;this.symbol=null,this.value=null;do{if(this.done)return!1;for(var name_1 in best=null,this.rules){var match=this.rules[name_1].exec(this.text);match&&(null===best||match[0].length>best[0].length)&&(best=match,bestSymbol=name_1)}if(null!=best&&(this.text=this.text.substr(best[0].length),""===this.text&&(this.done=!0)),null==best)return this.done=!0,this.symbol=null,void(this.value=null)}while("SKIP"===bestSymbol);return this.symbol=bestSymbol,this.value=best,!0},Parser.prototype.accept=function(name){if(this.symbol===name){if(this.value){var v=this.value;return this.nextSymbol(),v}return this.nextSymbol(),!0}return!1},Parser.prototype.acceptNumber=function(){return this.accept("number")},Parser.prototype.expect=function(name){if(this.accept(name))return!0;throw new Error("expected "+name+" but found "+this.symbol)},Parser}();function parseText(text,language){void 0===language&&(language=i18n);var options={},ttr=new Parser(language.tokens);return ttr.start(text)?(function(){ttr.expect("every");var n=ttr.acceptNumber();n&&(options.interval=parseInt(n[0],10));if(ttr.isDone())throw new Error("Unexpected end");switch(ttr.symbol){case"day(s)":options.freq=RRule.DAILY,ttr.nextSymbol()&&(AT(),F());break;case"weekday(s)":options.freq=RRule.WEEKLY,options.byweekday=[RRule.MO,RRule.TU,RRule.WE,RRule.TH,RRule.FR],ttr.nextSymbol(),AT(),F();break;case"week(s)":options.freq=RRule.WEEKLY,ttr.nextSymbol()&&(ON(),AT(),F());break;case"hour(s)":options.freq=RRule.HOURLY,ttr.nextSymbol()&&(ON(),F());break;case"minute(s)":options.freq=RRule.MINUTELY,ttr.nextSymbol()&&(ON(),F());break;case"month(s)":options.freq=RRule.MONTHLY,ttr.nextSymbol()&&(ON(),F());break;case"year(s)":options.freq=RRule.YEARLY,ttr.nextSymbol()&&(ON(),F());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":options.freq=RRule.WEEKLY;var key=ttr.symbol.substr(0,2).toUpperCase();if(options.byweekday=[RRule[key]],!ttr.nextSymbol())return;for(;ttr.accept("comma");){if(ttr.isDone())throw new Error("Unexpected end");var wkd=decodeWKD();if(!wkd)throw new Error("Unexpected symbol "+ttr.symbol+", expected weekday");options.byweekday.push(RRule[wkd]),ttr.nextSymbol()}AT(),function(){ttr.accept("on"),ttr.accept("the");var nth=decodeNTH();if(!nth)return;options.bymonthday=[nth],ttr.nextSymbol();for(;ttr.accept("comma");){if(!(nth=decodeNTH()))throw new Error("Unexpected symbol "+ttr.symbol+"; expected monthday");options.bymonthday.push(nth),ttr.nextSymbol()}}(),F();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(options.freq=RRule.YEARLY,options.bymonth=[decodeM()],!ttr.nextSymbol())return;for(;ttr.accept("comma");){if(ttr.isDone())throw new Error("Unexpected end");var m=decodeM();if(!m)throw new Error("Unexpected symbol "+ttr.symbol+", expected month");options.bymonth.push(m),ttr.nextSymbol()}ON(),F();break;default:throw new Error("Unknown symbol")}}(),options):null;function ON(){var on=ttr.accept("on"),the=ttr.accept("the");if(on||the)do{var nth=decodeNTH(),wkd=decodeWKD(),m=decodeM();if(nth)wkd?(ttr.nextSymbol(),options.byweekday||(options.byweekday=[]),options.byweekday.push(RRule[wkd].nth(nth))):(options.bymonthday||(options.bymonthday=[]),options.bymonthday.push(nth),ttr.accept("day(s)"));else if(wkd)ttr.nextSymbol(),options.byweekday||(options.byweekday=[]),options.byweekday.push(RRule[wkd]);else if("weekday(s)"===ttr.symbol)ttr.nextSymbol(),options.byweekday||(options.byweekday=[RRule.MO,RRule.TU,RRule.WE,RRule.TH,RRule.FR]);else if("week(s)"===ttr.symbol){ttr.nextSymbol();var n=ttr.acceptNumber();if(!n)throw new Error("Unexpected symbol "+ttr.symbol+", expected week number");for(options.byweekno=[parseInt(n[0],10)];ttr.accept("comma");){if(!(n=ttr.acceptNumber()))throw new Error("Unexpected symbol "+ttr.symbol+"; expected monthday");options.byweekno.push(parseInt(n[0],10))}}else{if(!m)return;ttr.nextSymbol(),options.bymonth||(options.bymonth=[]),options.bymonth.push(m)}}while(ttr.accept("comma")||ttr.accept("the")||ttr.accept("on"))}function AT(){if(ttr.accept("at"))do{var n=ttr.acceptNumber();if(!n)throw new Error("Unexpected symbol "+ttr.symbol+", expected hour");for(options.byhour=[parseInt(n[0],10)];ttr.accept("comma");){if(!(n=ttr.acceptNumber()))throw new Error("Unexpected symbol "+ttr.symbol+"; expected hour");options.byhour.push(parseInt(n[0],10))}}while(ttr.accept("comma")||ttr.accept("at"))}function decodeM(){switch(ttr.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function decodeWKD(){switch(ttr.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return ttr.symbol.substr(0,2).toUpperCase();default:return!1}}function decodeNTH(){switch(ttr.symbol){case"last":return ttr.nextSymbol(),-1;case"first":return ttr.nextSymbol(),1;case"second":return ttr.nextSymbol(),ttr.accept("last")?-2:2;case"third":return ttr.nextSymbol(),ttr.accept("last")?-3:3;case"nth":var v=parseInt(ttr.value[1],10);if(v<-366||v>366)throw new Error("Nth out of range: "+v);return ttr.nextSymbol(),ttr.accept("last")?-v:v;default:return!1}}function F(){if("until"===ttr.symbol){var date=Date.parse(ttr.text);if(!date)throw new Error("Cannot parse until date:"+ttr.text);options.until=new Date(date)}else ttr.accept("for")&&(options.count=parseInt(ttr.value[0],10),ttr.expect("number"))}}function freqIsDailyOrGreater(freq){return freq<Frequency.HOURLY}!function(Frequency){Frequency[Frequency.YEARLY=0]="YEARLY",Frequency[Frequency.MONTHLY=1]="MONTHLY",Frequency[Frequency.WEEKLY=2]="WEEKLY",Frequency[Frequency.DAILY=3]="DAILY",Frequency[Frequency.HOURLY=4]="HOURLY",Frequency[Frequency.MINUTELY=5]="MINUTELY",Frequency[Frequency.SECONDLY=6]="SECONDLY"}(Frequency||(Frequency={}));var fromText=function(text,language){return void 0===language&&(language=i18n),new RRule(parseText(text,language)||void 0)},common=["count","until","interval","byweekday","bymonthday","bymonth"];totext.IMPLEMENTED=[],totext.IMPLEMENTED[Frequency.HOURLY]=common,totext.IMPLEMENTED[Frequency.MINUTELY]=common,totext.IMPLEMENTED[Frequency.DAILY]=["byhour"].concat(common),totext.IMPLEMENTED[Frequency.WEEKLY]=common,totext.IMPLEMENTED[Frequency.MONTHLY]=common,totext.IMPLEMENTED[Frequency.YEARLY]=["byweekno","byyearday"].concat(common);var isFullyConvertible=totext.isFullyConvertible,Time=function(){function Time(hour,minute,second,millisecond){this.hour=hour,this.minute=minute,this.second=second,this.millisecond=millisecond||0}return Time.prototype.getHours=function(){return this.hour},Time.prototype.getMinutes=function(){return this.minute},Time.prototype.getSeconds=function(){return this.second},Time.prototype.getMilliseconds=function(){return this.millisecond},Time.prototype.getTime=function(){return 1e3*(60*this.hour*60+60*this.minute+this.second)+this.millisecond},Time}(),DateTime=function(_super){function DateTime(year,month,day,hour,minute,second,millisecond){var _this=_super.call(this,hour,minute,second,millisecond)||this;return _this.year=year,_this.month=month,_this.day=day,_this}return __extends(DateTime,_super),DateTime.fromDate=function(date){return new this(date.getUTCFullYear(),date.getUTCMonth()+1,date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds(),date.valueOf()%1e3)},DateTime.prototype.getWeekday=function(){return getWeekday(new Date(this.getTime()))},DateTime.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},DateTime.prototype.getDay=function(){return this.day},DateTime.prototype.getMonth=function(){return this.month},DateTime.prototype.getYear=function(){return this.year},DateTime.prototype.addYears=function(years){this.year+=years},DateTime.prototype.addMonths=function(months){if(this.month+=months,this.month>12){var yearDiv=Math.floor(this.month/12),monthMod=pymod(this.month,12);this.month=monthMod,this.year+=yearDiv,0===this.month&&(this.month=12,--this.year)}},DateTime.prototype.addWeekly=function(days,wkst){wkst>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-wkst))+7*days:this.day+=-(this.getWeekday()-wkst)+7*days,this.fixDay()},DateTime.prototype.addDaily=function(days){this.day+=days,this.fixDay()},DateTime.prototype.addHours=function(hours,filtered,byhour){for(filtered&&(this.hour+=Math.floor((23-this.hour)/hours)*hours);;){this.hour+=hours;var _a=divmod(this.hour,24),dayDiv=_a.div,hourMod=_a.mod;if(dayDiv&&(this.hour=hourMod,this.addDaily(dayDiv)),empty(byhour)||includes(byhour,this.hour))break}},DateTime.prototype.addMinutes=function(minutes,filtered,byhour,byminute){for(filtered&&(this.minute+=Math.floor((1439-(60*this.hour+this.minute))/minutes)*minutes);;){this.minute+=minutes;var _a=divmod(this.minute,60),hourDiv=_a.div,minuteMod=_a.mod;if(hourDiv&&(this.minute=minuteMod,this.addHours(hourDiv,!1,byhour)),(empty(byhour)||includes(byhour,this.hour))&&(empty(byminute)||includes(byminute,this.minute)))break}},DateTime.prototype.addSeconds=function(seconds,filtered,byhour,byminute,bysecond){for(filtered&&(this.second+=Math.floor((86399-(3600*this.hour+60*this.minute+this.second))/seconds)*seconds);;){this.second+=seconds;var _a=divmod(this.second,60),minuteDiv=_a.div,secondMod=_a.mod;if(minuteDiv&&(this.second=secondMod,this.addMinutes(minuteDiv,!1,byhour,byminute)),(empty(byhour)||includes(byhour,this.hour))&&(empty(byminute)||includes(byminute,this.minute))&&(empty(bysecond)||includes(bysecond,this.second)))break}},DateTime.prototype.fixDay=function(){if(!(this.day<=28)){var daysinmonth=monthRange(this.year,this.month-1)[1];if(!(this.day<=daysinmonth))for(;this.day>daysinmonth;){if(this.day-=daysinmonth,++this.month,13===this.month&&(this.month=1,++this.year,this.year>MAXYEAR))return;daysinmonth=monthRange(this.year,this.month-1)[1]}}},DateTime.prototype.add=function(options,filtered){var freq=options.freq,interval=options.interval,wkst=options.wkst,byhour=options.byhour,byminute=options.byminute,bysecond=options.bysecond;switch(freq){case Frequency.YEARLY:return this.addYears(interval);case Frequency.MONTHLY:return this.addMonths(interval);case Frequency.WEEKLY:return this.addWeekly(interval,wkst);case Frequency.DAILY:return this.addDaily(interval);case Frequency.HOURLY:return this.addHours(interval,filtered,byhour);case Frequency.MINUTELY:return this.addMinutes(interval,filtered,byhour,byminute);case Frequency.SECONDLY:return this.addSeconds(interval,filtered,byhour,byminute,bysecond)}},DateTime}(Time);function initializeOptions(options){for(var invalid=[],_i=0,keys_1=Object.keys(options);_i<keys_1.length;_i++){var key=keys_1[_i];includes(defaultKeys,key)||invalid.push(key),isDate(options[key])&&!isValidDate(options[key])&&invalid.push(key)}if(invalid.length)throw new Error("Invalid options: "+invalid.join(", "));return __assign({},options)}function parseOptions(options){var opts=__assign(__assign({},DEFAULT_OPTIONS),initializeOptions(options));if(isPresent(opts.byeaster)&&(opts.freq=RRule.YEARLY),!isPresent(opts.freq)||!RRule.FREQUENCIES[opts.freq])throw new Error("Invalid frequency: ".concat(opts.freq," ").concat(options.freq));if(opts.dtstart||(opts.dtstart=new Date((new Date).setMilliseconds(0))),isPresent(opts.wkst)?isNumber(opts.wkst)||(opts.wkst=opts.wkst.weekday):opts.wkst=RRule.MO.weekday,isPresent(opts.bysetpos)){isNumber(opts.bysetpos)&&(opts.bysetpos=[opts.bysetpos]);for(var i=0;i<opts.bysetpos.length;i++){if(0===(v=opts.bysetpos[i])||!(v>=-366&&v<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(Boolean(opts.byweekno)||notEmpty(opts.byweekno)||notEmpty(opts.byyearday)||Boolean(opts.bymonthday)||notEmpty(opts.bymonthday)||isPresent(opts.byweekday)||isPresent(opts.byeaster)))switch(opts.freq){case RRule.YEARLY:opts.bymonth||(opts.bymonth=opts.dtstart.getUTCMonth()+1),opts.bymonthday=opts.dtstart.getUTCDate();break;case RRule.MONTHLY:opts.bymonthday=opts.dtstart.getUTCDate();break;case RRule.WEEKLY:opts.byweekday=[getWeekday(opts.dtstart)]}if(isPresent(opts.bymonth)&&!isArray(opts.bymonth)&&(opts.bymonth=[opts.bymonth]),isPresent(opts.byyearday)&&!isArray(opts.byyearday)&&isNumber(opts.byyearday)&&(opts.byyearday=[opts.byyearday]),isPresent(opts.bymonthday))if(isArray(opts.bymonthday)){var bymonthday=[],bynmonthday=[];for(i=0;i<opts.bymonthday.length;i++){var v;(v=opts.bymonthday[i])>0?bymonthday.push(v):v<0&&bynmonthday.push(v)}opts.bymonthday=bymonthday,opts.bynmonthday=bynmonthday}else opts.bymonthday<0?(opts.bynmonthday=[opts.bymonthday],opts.bymonthday=[]):(opts.bynmonthday=[],opts.bymonthday=[opts.bymonthday]);else opts.bymonthday=[],opts.bynmonthday=[];if(isPresent(opts.byweekno)&&!isArray(opts.byweekno)&&(opts.byweekno=[opts.byweekno]),isPresent(opts.byweekday))if(isNumber(opts.byweekday))opts.byweekday=[opts.byweekday],opts.bynweekday=null;else if(isWeekdayStr(opts.byweekday))opts.byweekday=[Weekday.fromStr(opts.byweekday).weekday],opts.bynweekday=null;else if(opts.byweekday instanceof Weekday)!opts.byweekday.n||opts.freq>RRule.MONTHLY?(opts.byweekday=[opts.byweekday.weekday],opts.bynweekday=null):(opts.bynweekday=[[opts.byweekday.weekday,opts.byweekday.n]],opts.byweekday=null);else{var byweekday=[],bynweekday=[];for(i=0;i<opts.byweekday.length;i++){var wday=opts.byweekday[i];isNumber(wday)?byweekday.push(wday):isWeekdayStr(wday)?byweekday.push(Weekday.fromStr(wday).weekday):!wday.n||opts.freq>RRule.MONTHLY?byweekday.push(wday.weekday):bynweekday.push([wday.weekday,wday.n])}opts.byweekday=notEmpty(byweekday)?byweekday:null,opts.bynweekday=notEmpty(bynweekday)?bynweekday:null}else opts.bynweekday=null;return isPresent(opts.byhour)?isNumber(opts.byhour)&&(opts.byhour=[opts.byhour]):opts.byhour=opts.freq<RRule.HOURLY?[opts.dtstart.getUTCHours()]:null,isPresent(opts.byminute)?isNumber(opts.byminute)&&(opts.byminute=[opts.byminute]):opts.byminute=opts.freq<RRule.MINUTELY?[opts.dtstart.getUTCMinutes()]:null,isPresent(opts.bysecond)?isNumber(opts.bysecond)&&(opts.bysecond=[opts.bysecond]):opts.bysecond=opts.freq<RRule.SECONDLY?[opts.dtstart.getUTCSeconds()]:null,{parsedOptions:opts}}function parseString(rfcString){var options=rfcString.split("\n").map(parseLine).filter((function(x){return null!==x}));return __assign(__assign({},options[0]),options[1])}function parseDtstart(line){var options={},dtstartWithZone=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(line);if(!dtstartWithZone)return options;var tzid=dtstartWithZone[1],dtstart=dtstartWithZone[2];return tzid&&(options.tzid=tzid),options.dtstart=untilStringToDate(dtstart),options}function parseLine(rfcString){if(!(rfcString=rfcString.replace(/^\s+|\s+$/,"")).length)return null;var header=/^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());if(!header)return parseRrule(rfcString);var key=header[1];switch(key.toUpperCase()){case"RRULE":case"EXRULE":return parseRrule(rfcString);case"DTSTART":return parseDtstart(rfcString);default:throw new Error("Unsupported RFC prop ".concat(key," in ").concat(rfcString))}}function parseRrule(line){var options=parseDtstart(line.replace(/^RRULE:/i,""));return line.replace(/^(?:RRULE|EXRULE):/i,"").split(";").forEach((function(attr){var _a=attr.split("="),key=_a[0],value=_a[1];switch(key.toUpperCase()){case"FREQ":options.freq=Frequency[value.toUpperCase()];break;case"WKST":options.wkst=Days[value.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var num=function(value){if(-1!==value.indexOf(",")){return value.split(",").map(parseIndividualNumber)}return parseIndividualNumber(value)}(value),optionKey=key.toLowerCase();options[optionKey]=num;break;case"BYWEEKDAY":case"BYDAY":options.byweekday=function(value){var days=value.split(",");return days.map((function(day){if(2===day.length)return Days[day];var parts=day.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!parts||parts.length<3)throw new SyntaxError("Invalid weekday string: ".concat(day));var n=Number(parts[1]),wdaypart=parts[2],wday=Days[wdaypart].weekday;return new Weekday(wday,n)}))}(value);break;case"DTSTART":case"TZID":var dtstart=parseDtstart(line);options.tzid=dtstart.tzid,options.dtstart=dtstart.dtstart;break;case"UNTIL":options.until=untilStringToDate(value);break;case"BYEASTER":options.byeaster=Number(value);break;default:throw new Error("Unknown RRULE property '"+key+"'")}})),options}function parseIndividualNumber(value){return/^[+-]?\d+$/.test(value)?Number(value):value}var DateWithZone=function(){function DateWithZone(date,tzid){if(isNaN(date.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=date,this.tzid=tzid}return Object.defineProperty(DateWithZone.prototype,"isUTC",{get:function(){return!this.tzid||"UTC"===this.tzid.toUpperCase()},enumerable:!1,configurable:!0}),DateWithZone.prototype.toString=function(){var datestr=timeToUntilString(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(datestr):";TZID=".concat(this.tzid,":").concat(datestr)},DateWithZone.prototype.getTime=function(){return this.date.getTime()},DateWithZone.prototype.rezonedDate=function(){return this.isUTC?this.date:function(date,timeZone){var localTimeZone=Intl.DateTimeFormat().resolvedOptions().timeZone,dateInLocalTZ=new Date(dateTZtoISO8601(date,localTimeZone)),tzOffset=new Date(dateTZtoISO8601(date,null!=timeZone?timeZone:"UTC")).getTime()-dateInLocalTZ.getTime();return new Date(date.getTime()-tzOffset)}(this.date,this.tzid)},DateWithZone}();function optionsToString(options){for(var item,rrule=[],dtstart="",keys=Object.keys(options),defaultKeys=Object.keys(DEFAULT_OPTIONS),i=0;i<keys.length;i++)if("tzid"!==keys[i]&&includes(defaultKeys,keys[i])){var key=keys[i].toUpperCase(),value=options[keys[i]],outValue="";if(isPresent(value)&&(!isArray(value)||value.length)){switch(key){case"FREQ":outValue=RRule.FREQUENCIES[options.freq];break;case"WKST":outValue=isNumber(value)?new Weekday(value).toString():value.toString();break;case"BYWEEKDAY":key="BYDAY",outValue=(item=value,isArray(item)?item:[item]).map((function(wday){return wday instanceof Weekday?wday:isArray(wday)?new Weekday(wday[0],wday[1]):new Weekday(wday)})).toString();break;case"DTSTART":dtstart=buildDtstart(value,options.tzid);break;case"UNTIL":outValue=timeToUntilString(value,!options.tzid);break;default:if(isArray(value)){for(var strValues=[],j=0;j<value.length;j++)strValues[j]=String(value[j]);outValue=strValues.toString()}else outValue=String(value)}outValue&&rrule.push([key,outValue])}}var rules=rrule.map((function(_a){var key=_a[0],value=_a[1];return"".concat(key,"=").concat(value.toString())})).join(";"),ruleString="";return""!==rules&&(ruleString="RRULE:".concat(rules)),[dtstart,ruleString].filter((function(x){return!!x})).join("\n")}function buildDtstart(dtstart,tzid){return dtstart?"DTSTART"+new DateWithZone(new Date(dtstart),tzid).toString():""}function argsMatch(left,right){return Array.isArray(left)?!!Array.isArray(right)&&(left.length===right.length&&left.every((function(date,i){return date.getTime()===right[i].getTime()}))):left instanceof Date?right instanceof Date&&left.getTime()===right.getTime():left===right}var Cache=function(){function Cache(){this.all=!1,this.before=[],this.after=[],this.between=[]}return Cache.prototype._cacheAdd=function(what,value,args){value&&(value=value instanceof Date?dateutil_clone(value):cloneDates(value)),"all"===what?this.all=value:(args._value=value,this[what].push(args))},Cache.prototype._cacheGet=function(what,args){var cached=!1,argsKeys=args?Object.keys(args):[],findCacheDiff=function(item){for(var i=0;i<argsKeys.length;i++){var key=argsKeys[i];if(!argsMatch(args[key],item[key]))return!0}return!1},cachedObject=this[what];if("all"===what)cached=this.all;else if(isArray(cachedObject))for(var i=0;i<cachedObject.length;i++){var item=cachedObject[i];if(!argsKeys.length||!findCacheDiff(item)){cached=item._value;break}}if(!cached&&this.all){var iterResult=new iterresult(what,args);for(i=0;i<this.all.length&&iterResult.accept(this.all[i]);i++);cached=iterResult.getValue(),this._cacheAdd(what,cached,args)}return isArray(cached)?cloneDates(cached):cached instanceof Date?dateutil_clone(cached):cached},Cache}(),M365MASK=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],repeat(1,31),!0),repeat(2,28),!0),repeat(3,31),!0),repeat(4,30),!0),repeat(5,31),!0),repeat(6,30),!0),repeat(7,31),!0),repeat(8,31),!0),repeat(9,30),!0),repeat(10,31),!0),repeat(11,30),!0),repeat(12,31),!0),repeat(1,7),!0),M366MASK=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],repeat(1,31),!0),repeat(2,29),!0),repeat(3,31),!0),repeat(4,30),!0),repeat(5,31),!0),repeat(6,30),!0),repeat(7,31),!0),repeat(8,31),!0),repeat(9,30),!0),repeat(10,31),!0),repeat(11,30),!0),repeat(12,31),!0),repeat(1,7),!0),M28=range(1,29),M29=range(1,30),M30=range(1,31),M31=range(1,32),MDAY366MASK=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],M31,!0),M29,!0),M31,!0),M30,!0),M31,!0),M30,!0),M31,!0),M31,!0),M30,!0),M31,!0),M30,!0),M31,!0),M31.slice(0,7),!0),MDAY365MASK=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],M31,!0),M28,!0),M31,!0),M30,!0),M31,!0),M30,!0),M31,!0),M31,!0),M30,!0),M31,!0),M30,!0),M31,!0),M31.slice(0,7),!0),NM28=range(-28,0),NM29=range(-29,0),NM30=range(-30,0),NM31=range(-31,0),NMDAY366MASK=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],NM31,!0),NM29,!0),NM31,!0),NM30,!0),NM31,!0),NM30,!0),NM31,!0),NM31,!0),NM30,!0),NM31,!0),NM30,!0),NM31,!0),NM31.slice(0,7),!0),NMDAY365MASK=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],NM31,!0),NM28,!0),NM31,!0),NM30,!0),NM31,!0),NM30,!0),NM31,!0),NM31,!0),NM30,!0),NM31,!0),NM30,!0),NM31,!0),NM31.slice(0,7),!0),M366RANGE=[0,31,60,91,121,152,182,213,244,274,305,335,366],M365RANGE=[0,31,59,90,120,151,181,212,243,273,304,334,365],WDAYMASK=function(){for(var wdaymask=[],i=0;i<55;i++)wdaymask=wdaymask.concat(range(7));return wdaymask}();function rebuildYear(year,options){var firstwkst,wyearlen,firstyday=datetime(year,1,1),yearlen=isLeapYear(year)?366:365,nextyearlen=isLeapYear(year+1)?366:365,yearordinal=toOrdinal(firstyday),yearweekday=getWeekday(firstyday),result=__assign(__assign({yearlen,nextyearlen,yearordinal,yearweekday},function(year){var yearlen=isLeapYear(year)?366:365,firstyday=datetime(year,1,1),wday=getWeekday(firstyday);if(365===yearlen)return{mmask:M365MASK,mdaymask:MDAY365MASK,nmdaymask:NMDAY365MASK,wdaymask:WDAYMASK.slice(wday),mrange:M365RANGE};return{mmask:M366MASK,mdaymask:MDAY366MASK,nmdaymask:NMDAY366MASK,wdaymask:WDAYMASK.slice(wday),mrange:M366RANGE}}(year)),{wnomask:null});if(empty(options.byweekno))return result;result.wnomask=repeat(0,yearlen+7);var no1wkst=firstwkst=pymod(7-yearweekday+options.wkst,7);no1wkst>=4?(no1wkst=0,wyearlen=result.yearlen+pymod(yearweekday-options.wkst,7)):wyearlen=yearlen-no1wkst;for(var div=Math.floor(wyearlen/7),mod=pymod(wyearlen,7),numweeks=Math.floor(div+mod/4),j=0;j<options.byweekno.length;j++){var n=options.byweekno[j];if(n<0&&(n+=numweeks+1),n>0&&n<=numweeks){var i=void 0;n>1?(i=no1wkst+7*(n-1),no1wkst!==firstwkst&&(i-=7-firstwkst)):i=no1wkst;for(var k=0;k<7&&(result.wnomask[i]=1,i++,result.wdaymask[i]!==options.wkst);k++);}}if(includes(options.byweekno,1)){i=no1wkst+7*numweeks;if(no1wkst!==firstwkst&&(i-=7-firstwkst),i<yearlen)for(j=0;j<7&&(result.wnomask[i]=1,i+=1,result.wdaymask[i]!==options.wkst);j++);}if(no1wkst){var lnumweeks=void 0;if(includes(options.byweekno,-1))lnumweeks=-1;else{var lyearweekday=getWeekday(datetime(year-1,1,1)),lno1wkst=pymod(7-lyearweekday.valueOf()+options.wkst,7),lyearlen=isLeapYear(year-1)?366:365,weekst=void 0;lno1wkst>=4?(lno1wkst=0,weekst=lyearlen+pymod(lyearweekday-options.wkst,7)):weekst=yearlen-no1wkst,lnumweeks=Math.floor(52+pymod(weekst,7)/4)}if(includes(options.byweekno,lnumweeks))for(i=0;i<no1wkst;i++)result.wnomask[i]=1}return result}const iterinfo=function(){function Iterinfo(options){this.options=options}return Iterinfo.prototype.rebuild=function(year,month){var options=this.options;if(year!==this.lastyear&&(this.yearinfo=rebuildYear(year,options)),notEmpty(options.bynweekday)&&(month!==this.lastmonth||year!==this.lastyear)){var _a=this.yearinfo,yearlen=_a.yearlen,mrange=_a.mrange,wdaymask=_a.wdaymask;this.monthinfo=function(year,month,yearlen,mrange,wdaymask,options){var result={lastyear:year,lastmonth:month,nwdaymask:[]},ranges=[];if(options.freq===RRule.YEARLY)if(empty(options.bymonth))ranges=[[0,yearlen]];else for(var j=0;j<options.bymonth.length;j++)month=options.bymonth[j],ranges.push(mrange.slice(month-1,month+1));else options.freq===RRule.MONTHLY&&(ranges=[mrange.slice(month-1,month+1)]);if(empty(ranges))return result;for(result.nwdaymask=repeat(0,yearlen),j=0;j<ranges.length;j++)for(var rang=ranges[j],first=rang[0],last=rang[1]-1,k=0;k<options.bynweekday.length;k++){var i=void 0,_a=options.bynweekday[k],wday=_a[0],n=_a[1];n<0?(i=last+7*(n+1),i-=pymod(wdaymask[i]-wday,7)):(i=first+7*(n-1),i+=pymod(7-wdaymask[i]+wday,7)),first<=i&&i<=last&&(result.nwdaymask[i]=1)}return result}(year,month,yearlen,mrange,wdaymask,options)}isPresent(options.byeaster)&&(this.eastermask=function(y,offset){void 0===offset&&(offset=0);var a=y%19,b=Math.floor(y/100),c=y%100,d=Math.floor(b/4),e=b%4,f=Math.floor((b+8)/25),g=Math.floor((b-f+1)/3),h=Math.floor(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4,l=Math.floor(32+2*e+2*i-h-k)%7,m=Math.floor((a+11*h+22*l)/451),month=Math.floor((h+l-7*m+114)/31),day=(h+l-7*m+114)%31+1,date=Date.UTC(y,month-1,day+offset),yearStart=Date.UTC(y,0,1);return[Math.ceil((date-yearStart)/864e5)]}(year,options.byeaster))},Object.defineProperty(Iterinfo.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(Iterinfo.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),Iterinfo.prototype.ydayset=function(){return[range(this.yearlen),0,this.yearlen]},Iterinfo.prototype.mdayset=function(_,month){for(var start=this.mrange[month-1],end=this.mrange[month],set=repeat(null,this.yearlen),i=start;i<end;i++)set[i]=i;return[set,start,end]},Iterinfo.prototype.wdayset=function(year,month,day){for(var set=repeat(null,this.yearlen+7),i=toOrdinal(datetime(year,month,day))-this.yearordinal,start=i,j=0;j<7&&(set[i]=i,++i,this.wdaymask[i]!==this.options.wkst);j++);return[set,start,i]},Iterinfo.prototype.ddayset=function(year,month,day){var set=repeat(null,this.yearlen),i=toOrdinal(datetime(year,month,day))-this.yearordinal;return set[i]=i,[set,i,i+1]},Iterinfo.prototype.htimeset=function(hour,_,second,millisecond){var _this=this,set=[];return this.options.byminute.forEach((function(minute){set=set.concat(_this.mtimeset(hour,minute,second,millisecond))})),sort(set),set},Iterinfo.prototype.mtimeset=function(hour,minute,_,millisecond){var set=this.options.bysecond.map((function(second){return new Time(hour,minute,second,millisecond)}));return sort(set),set},Iterinfo.prototype.stimeset=function(hour,minute,second,millisecond){return[new Time(hour,minute,second,millisecond)]},Iterinfo.prototype.getdayset=function(freq){switch(freq){case Frequency.YEARLY:return this.ydayset.bind(this);case Frequency.MONTHLY:return this.mdayset.bind(this);case Frequency.WEEKLY:return this.wdayset.bind(this);case Frequency.DAILY:default:return this.ddayset.bind(this)}},Iterinfo.prototype.gettimeset=function(freq){switch(freq){case Frequency.HOURLY:return this.htimeset.bind(this);case Frequency.MINUTELY:return this.mtimeset.bind(this);case Frequency.SECONDLY:return this.stimeset.bind(this)}},Iterinfo}();function buildPoslist(bysetpos,timeset,start,end,ii,dayset){for(var poslist=[],j=0;j<bysetpos.length;j++){var daypos=void 0,timepos=void 0,pos=bysetpos[j];pos<0?(daypos=Math.floor(pos/timeset.length),timepos=pymod(pos,timeset.length)):(daypos=Math.floor((pos-1)/timeset.length),timepos=pymod(pos-1,timeset.length));for(var tmp=[],k=start;k<end;k++){var val=dayset[k];isPresent(val)&&tmp.push(val)}var i=void 0;i=daypos<0?tmp.slice(daypos)[0]:tmp[daypos];var time=timeset[timepos],date=fromOrdinal(ii.yearordinal+i),res=combine(date,time);includes(poslist,res)||poslist.push(res)}return sort(poslist),poslist}function iter(iterResult,options){var dtstart=options.dtstart,freq=options.freq,interval=options.interval,until=options.until,bysetpos=options.bysetpos,count=options.count;if(0===count||0===interval)return emitResult(iterResult);var counterDate=DateTime.fromDate(dtstart),ii=new iterinfo(options);ii.rebuild(counterDate.year,counterDate.month);for(var timeset=function(ii,counterDate,options){var freq=options.freq,byhour=options.byhour,byminute=options.byminute,bysecond=options.bysecond;if(freqIsDailyOrGreater(freq))return function(opts){var millisecondModulo=opts.dtstart.getTime()%1e3;if(!freqIsDailyOrGreater(opts.freq))return[];var timeset=[];return opts.byhour.forEach((function(hour){opts.byminute.forEach((function(minute){opts.bysecond.forEach((function(second){timeset.push(new Time(hour,minute,second,millisecondModulo))}))}))})),timeset}(options);if(freq>=RRule.HOURLY&&notEmpty(byhour)&&!includes(byhour,counterDate.hour)||freq>=RRule.MINUTELY&&notEmpty(byminute)&&!includes(byminute,counterDate.minute)||freq>=RRule.SECONDLY&&notEmpty(bysecond)&&!includes(bysecond,counterDate.second))return[];return ii.gettimeset(freq)(counterDate.hour,counterDate.minute,counterDate.second,counterDate.millisecond)}(ii,counterDate,options);;){var _a=ii.getdayset(freq)(counterDate.year,counterDate.month,counterDate.day),dayset=_a[0],start=_a[1],end=_a[2],filtered=removeFilteredDays(dayset,start,end,ii,options);if(notEmpty(bysetpos))for(var poslist=buildPoslist(bysetpos,timeset,start,end,ii,dayset),j=0;j<poslist.length;j++){var res=poslist[j];if(until&&res>until)return emitResult(iterResult);if(res>=dtstart){var rezonedDate=rezoneIfNeeded(res,options);if(!iterResult.accept(rezonedDate))return emitResult(iterResult);if(count&&! --count)return emitResult(iterResult)}}else for(j=start;j<end;j++){var currentDay=dayset[j];if(isPresent(currentDay))for(var date=fromOrdinal(ii.yearordinal+currentDay),k=0;k<timeset.length;k++){var time=timeset[k];res=combine(date,time);if(until&&res>until)return emitResult(iterResult);if(res>=dtstart){rezonedDate=rezoneIfNeeded(res,options);if(!iterResult.accept(rezonedDate))return emitResult(iterResult);if(count&&! --count)return emitResult(iterResult)}}}if(0===options.interval)return emitResult(iterResult);if(counterDate.add(options,filtered),counterDate.year>MAXYEAR)return emitResult(iterResult);freqIsDailyOrGreater(freq)||(timeset=ii.gettimeset(freq)(counterDate.hour,counterDate.minute,counterDate.second,0)),ii.rebuild(counterDate.year,counterDate.month)}}function isFiltered(ii,currentDay,options){var bymonth=options.bymonth,byweekno=options.byweekno,byweekday=options.byweekday,byeaster=options.byeaster,bymonthday=options.bymonthday,bynmonthday=options.bynmonthday,byyearday=options.byyearday;return notEmpty(bymonth)&&!includes(bymonth,ii.mmask[currentDay])||notEmpty(byweekno)&&!ii.wnomask[currentDay]||notEmpty(byweekday)&&!includes(byweekday,ii.wdaymask[currentDay])||notEmpty(ii.nwdaymask)&&!ii.nwdaymask[currentDay]||null!==byeaster&&!includes(ii.eastermask,currentDay)||(notEmpty(bymonthday)||notEmpty(bynmonthday))&&!includes(bymonthday,ii.mdaymask[currentDay])&&!includes(bynmonthday,ii.nmdaymask[currentDay])||notEmpty(byyearday)&&(currentDay<ii.yearlen&&!includes(byyearday,currentDay+1)&&!includes(byyearday,-ii.yearlen+currentDay)||currentDay>=ii.yearlen&&!includes(byyearday,currentDay+1-ii.yearlen)&&!includes(byyearday,-ii.nextyearlen+currentDay-ii.yearlen))}function rezoneIfNeeded(date,options){return new DateWithZone(date,options.tzid).rezonedDate()}function emitResult(iterResult){return iterResult.getValue()}function removeFilteredDays(dayset,start,end,ii,options){for(var filtered=!1,dayCounter=start;dayCounter<end;dayCounter++){var currentDay=dayset[dayCounter];(filtered=isFiltered(ii,currentDay,options))&&(dayset[currentDay]=null)}return filtered}var Days={MO:new Weekday(0),TU:new Weekday(1),WE:new Weekday(2),TH:new Weekday(3),FR:new Weekday(4),SA:new Weekday(5),SU:new Weekday(6)},DEFAULT_OPTIONS={freq:Frequency.YEARLY,dtstart:null,interval:1,wkst:Days.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},defaultKeys=Object.keys(DEFAULT_OPTIONS),RRule=function(){function RRule(options,noCache){void 0===options&&(options={}),void 0===noCache&&(noCache=!1),this._cache=noCache?null:new Cache,this.origOptions=initializeOptions(options);var parsedOptions=parseOptions(options).parsedOptions;this.options=parsedOptions}return RRule.parseText=function(text,language){return parseText(text,language)},RRule.fromText=function(text,language){return fromText(text,language)},RRule.fromString=function(str){return new RRule(RRule.parseString(str)||void 0)},RRule.prototype._iter=function(iterResult){return iter(iterResult,this.options)},RRule.prototype._cacheGet=function(what,args){return!!this._cache&&this._cache._cacheGet(what,args)},RRule.prototype._cacheAdd=function(what,value,args){if(this._cache)return this._cache._cacheAdd(what,value,args)},RRule.prototype.all=function(iterator){if(iterator)return this._iter(new callbackiterresult("all",{},iterator));var result=this._cacheGet("all");return!1===result&&(result=this._iter(new iterresult("all",{})),this._cacheAdd("all",result)),result},RRule.prototype.between=function(after,before,inc,iterator){if(void 0===inc&&(inc=!1),!isValidDate(after)||!isValidDate(before))throw new Error("Invalid date passed in to RRule.between");var args={before,after,inc};if(iterator)return this._iter(new callbackiterresult("between",args,iterator));var result=this._cacheGet("between",args);return!1===result&&(result=this._iter(new iterresult("between",args)),this._cacheAdd("between",result,args)),result},RRule.prototype.before=function(dt,inc){if(void 0===inc&&(inc=!1),!isValidDate(dt))throw new Error("Invalid date passed in to RRule.before");var args={dt,inc},result=this._cacheGet("before",args);return!1===result&&(result=this._iter(new iterresult("before",args)),this._cacheAdd("before",result,args)),result},RRule.prototype.after=function(dt,inc){if(void 0===inc&&(inc=!1),!isValidDate(dt))throw new Error("Invalid date passed in to RRule.after");var args={dt,inc},result=this._cacheGet("after",args);return!1===result&&(result=this._iter(new iterresult("after",args)),this._cacheAdd("after",result,args)),result},RRule.prototype.count=function(){return this.all().length},RRule.prototype.toString=function(){return optionsToString(this.origOptions)},RRule.prototype.toText=function(gettext,language,dateFormatter){return function(rrule,gettext,language,dateFormatter){return new totext(rrule,gettext,language,dateFormatter).toString()}(this,gettext,language,dateFormatter)},RRule.prototype.isFullyConvertibleToText=function(){return isFullyConvertible(this)},RRule.prototype.clone=function(){return new RRule(this.origOptions)},RRule.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],RRule.YEARLY=Frequency.YEARLY,RRule.MONTHLY=Frequency.MONTHLY,RRule.WEEKLY=Frequency.WEEKLY,RRule.DAILY=Frequency.DAILY,RRule.HOURLY=Frequency.HOURLY,RRule.MINUTELY=Frequency.MINUTELY,RRule.SECONDLY=Frequency.SECONDLY,RRule.MO=Days.MO,RRule.TU=Days.TU,RRule.WE=Days.WE,RRule.TH=Days.TH,RRule.FR=Days.FR,RRule.SA=Days.SA,RRule.SU=Days.SU,RRule.parseString=parseString,RRule.optionsToString=optionsToString,RRule}();var rrulestr_DEFAULT_OPTIONS={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function parseInput(s,options){var rrulevals=[],rdatevals=[],exrulevals=[],exdatevals=[],parsedDtstart=parseDtstart(s),dtstart=parsedDtstart.dtstart,tzid=parsedDtstart.tzid,lines=function(s,unfold){void 0===unfold&&(unfold=!1);if(s=s&&s.trim(),!s)throw new Error("Invalid empty string");if(!unfold)return s.split(/\s/);var lines=s.split("\n"),i=0;for(;i<lines.length;){var line=lines[i]=lines[i].replace(/\s+$/g,"");line?i>0&&" "===line[0]?(lines[i-1]+=line.slice(1),lines.splice(i,1)):i+=1:lines.splice(i,1)}return lines}(s,options.unfold);return lines.forEach((function(line){var _a;if(line){var _b=function(line){var _a=function(line){if(-1===line.indexOf(":"))return{name:"RRULE",value:line};var _a=split(line,":",1),name=_a[0],value=_a[1];return{name,value}}(line),name=_a.name,value=_a.value,parms=name.split(";");if(!parms)throw new Error("empty property name");return{name:parms[0].toUpperCase(),parms:parms.slice(1),value}}(line),name=_b.name,parms=_b.parms,value=_b.value;switch(name.toUpperCase()){case"RRULE":if(parms.length)throw new Error("unsupported RRULE parm: ".concat(parms.join(",")));rrulevals.push(parseString(line));break;case"RDATE":var rdateTzid=(null!==(_a=/RDATE(?:;TZID=([^:=]+))?/i.exec(line))&&void 0!==_a?_a:[])[1];rdateTzid&&!tzid&&(tzid=rdateTzid),rdatevals=rdatevals.concat(parseRDate(value,parms));break;case"EXRULE":if(parms.length)throw new Error("unsupported EXRULE parm: ".concat(parms.join(",")));exrulevals.push(parseString(value));break;case"EXDATE":exdatevals=exdatevals.concat(parseRDate(value,parms));break;case"DTSTART":break;default:throw new Error("unsupported property: "+name)}}})),{dtstart,tzid,rrulevals,rdatevals,exrulevals,exdatevals}}function rrulestr(s,options){return void 0===options&&(options={}),function(s,options){var _a=parseInput(s,options),rrulevals=_a.rrulevals,rdatevals=_a.rdatevals,exrulevals=_a.exrulevals,exdatevals=_a.exdatevals,dtstart=_a.dtstart,tzid=_a.tzid,noCache=!1===options.cache;if(options.compatible&&(options.forceset=!0,options.unfold=!0),options.forceset||rrulevals.length>1||rdatevals.length||exrulevals.length||exdatevals.length){var rset_1=new RRuleSet(noCache);return rset_1.dtstart(dtstart),rset_1.tzid(tzid||void 0),rrulevals.forEach((function(val){rset_1.rrule(new RRule(groomRruleOptions(val,dtstart,tzid),noCache))})),rdatevals.forEach((function(date){rset_1.rdate(date)})),exrulevals.forEach((function(val){rset_1.exrule(new RRule(groomRruleOptions(val,dtstart,tzid),noCache))})),exdatevals.forEach((function(date){rset_1.exdate(date)})),options.compatible&&options.dtstart&&rset_1.rdate(dtstart),rset_1}var val=rrulevals[0]||{};return new RRule(groomRruleOptions(val,val.dtstart||options.dtstart||dtstart,val.tzid||options.tzid||tzid),noCache)}(s,function(options){var invalid=[],keys=Object.keys(options),defaultKeys=Object.keys(rrulestr_DEFAULT_OPTIONS);if(keys.forEach((function(key){includes(defaultKeys,key)||invalid.push(key)})),invalid.length)throw new Error("Invalid options: "+invalid.join(", "));return __assign(__assign({},rrulestr_DEFAULT_OPTIONS),options)}(options))}function groomRruleOptions(val,dtstart,tzid){return __assign(__assign({},val),{dtstart,tzid})}function parseRDate(rdateval,parms){return function(parms){parms.forEach((function(parm){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(parm))throw new Error("unsupported RDATE/EXDATE parm: "+parm)}))}(parms),rdateval.split(",").map((function(datestr){return untilStringToDate(datestr)}))}function createGetterSetter(fieldName){var _this=this;return function(field){if(void 0!==field&&(_this["_".concat(fieldName)]=field),void 0!==_this["_".concat(fieldName)])return _this["_".concat(fieldName)];for(var i=0;i<_this._rrule.length;i++){var field_1=_this._rrule[i].origOptions[fieldName];if(field_1)return field_1}}}var RRuleSet=function(_super){function RRuleSet(noCache){void 0===noCache&&(noCache=!1);var _this=_super.call(this,{},noCache)||this;return _this.dtstart=createGetterSetter.apply(_this,["dtstart"]),_this.tzid=createGetterSetter.apply(_this,["tzid"]),_this._rrule=[],_this._rdate=[],_this._exrule=[],_this._exdate=[],_this}return __extends(RRuleSet,_super),RRuleSet.prototype._iter=function(iterResult){return function(iterResult,_rrule,_exrule,_rdate,_exdate,tzid){var _exdateHash={},_accept=iterResult.accept;function evalExdate(after,before){_exrule.forEach((function(rrule){rrule.between(after,before,!0).forEach((function(date){_exdateHash[Number(date)]=!0}))}))}_exdate.forEach((function(date){var zonedDate=new DateWithZone(date,tzid).rezonedDate();_exdateHash[Number(zonedDate)]=!0})),iterResult.accept=function(date){var dt=Number(date);return isNaN(dt)?_accept.call(this,date):!(!_exdateHash[dt]&&(evalExdate(new Date(dt-1),new Date(dt+1)),!_exdateHash[dt]))||(_exdateHash[dt]=!0,_accept.call(this,date))},"between"===iterResult.method&&(evalExdate(iterResult.args.after,iterResult.args.before),iterResult.accept=function(date){var dt=Number(date);return!!_exdateHash[dt]||(_exdateHash[dt]=!0,_accept.call(this,date))});for(var i=0;i<_rdate.length;i++){var zonedDate=new DateWithZone(_rdate[i],tzid).rezonedDate();if(!iterResult.accept(new Date(zonedDate.getTime())))break}_rrule.forEach((function(rrule){iter(iterResult,rrule.options)}));var res=iterResult._result;switch(sort(res),iterResult.method){case"all":case"between":return res;case"before":return res.length&&res[res.length-1]||null;default:return res.length&&res[0]||null}}(iterResult,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},RRuleSet.prototype.rrule=function(rrule){_addRule(rrule,this._rrule)},RRuleSet.prototype.exrule=function(rrule){_addRule(rrule,this._exrule)},RRuleSet.prototype.rdate=function(date){_addDate(date,this._rdate)},RRuleSet.prototype.exdate=function(date){_addDate(date,this._exdate)},RRuleSet.prototype.rrules=function(){return this._rrule.map((function(e){return rrulestr(e.toString())}))},RRuleSet.prototype.exrules=function(){return this._exrule.map((function(e){return rrulestr(e.toString())}))},RRuleSet.prototype.rdates=function(){return this._rdate.map((function(e){return new Date(e.getTime())}))},RRuleSet.prototype.exdates=function(){return this._exdate.map((function(e){return new Date(e.getTime())}))},RRuleSet.prototype.valueOf=function(){var result=[];return!this._rrule.length&&this._dtstart&&(result=result.concat(optionsToString({dtstart:this._dtstart}))),this._rrule.forEach((function(rrule){result=result.concat(rrule.toString().split("\n"))})),this._exrule.forEach((function(exrule){result=result.concat(exrule.toString().split("\n").map((function(line){return line.replace(/^RRULE:/,"EXRULE:")})).filter((function(line){return!/^DTSTART/.test(line)})))})),this._rdate.length&&result.push(rdatesToString("RDATE",this._rdate,this.tzid())),this._exdate.length&&result.push(rdatesToString("EXDATE",this._exdate,this.tzid())),result},RRuleSet.prototype.toString=function(){return this.valueOf().join("\n")},RRuleSet.prototype.clone=function(){var rrs=new RRuleSet(!!this._cache);return this._rrule.forEach((function(rule){return rrs.rrule(rule.clone())})),this._exrule.forEach((function(rule){return rrs.exrule(rule.clone())})),this._rdate.forEach((function(date){return rrs.rdate(new Date(date.getTime()))})),this._exdate.forEach((function(date){return rrs.exdate(new Date(date.getTime()))})),rrs},RRuleSet}(RRule);function _addRule(rrule,collection){if(!(rrule instanceof RRule))throw new TypeError(String(rrule)+" is not RRule instance");includes(collection.map(String),String(rrule))||collection.push(rrule)}function _addDate(date,collection){if(!(date instanceof Date))throw new TypeError(String(date)+" is not Date instance");includes(collection.map(Number),Number(date))||(collection.push(date),sort(collection))}function rdatesToString(param,rdates,tzid){var isUTC=!tzid||"UTC"===tzid.toUpperCase(),header=isUTC?"".concat(param,":"):"".concat(param,";TZID=").concat(tzid,":"),dateString=rdates.map((function(rdate){return timeToUntilString(rdate.valueOf(),isUTC)})).join(",");return"".concat(header).concat(dateString)}var utils=__webpack_require__(771);external_jQuery_default()((function($){let defaultDate;var wc_bookings_locale=window.navigator.userLanguage||window.navigator.language,wc_bookings_timeout=0,currentDateRange={},wc_bookings_date_picker={init:function(){$("body").on("click",".wc-bookings-date-picker legend",this.toggle_calendar),$("body").on("click",".booking_date_year, .booking_date_month, .booking_date_day",this.open_calendar),$("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),$("body").on("keyup",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_keypress),$("body").on("keyup",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_keypress),$("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),$(".wc-bookings-date-picker legend").show(),$(".wc-bookings-date-picker").each((function(){var form=$(this).closest("form"),picker=form.find(".picker"),fieldset=$(this).closest("fieldset");wc_bookings_date_picker.date_picker_init(picker),"always_visible"==picker.data("display")?$(".wc-bookings-date-picker-date-fields",fieldset).hide():picker.hide(),picker.data("is_range_picker_enabled")&&(form.find("p.wc_bookings_field_duration").hide(),form.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==picker.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))}))},calc_duration:function(picker){var form=picker.closest("form"),fieldSet=picker.closest("fieldset"),unit=picker.data("durationUnit");setTimeout((function(){var days=1,e_year=parseInt(fieldSet.find("input.booking_to_date_year").val(),10),e_month=parseInt(fieldSet.find("input.booking_to_date_month").val(),10),e_day=parseInt(fieldSet.find("input.booking_to_date_day").val(),10),s_year=parseInt(fieldSet.find("input.booking_date_year").val(),10),s_month=parseInt(fieldSet.find("input.booking_date_month").val(),10),s_day=parseInt(fieldSet.find("input.booking_date_day").val(),10);if(e_year&&e_month>=0&&e_day&&s_year&&s_month>=0&&s_day){var s_date=new Date(Date.UTC(s_year,s_month-1,s_day)),e_date=new Date(Date.UTC(e_year,e_month-1,e_day));days=Math.floor((e_date.getTime()-s_date.getTime())/864e5),"day"===unit&&(days+=1)}form.find("#wc_bookings_field_duration").val(days).trigger("change")}))},open_calendar:function(){const $picker=$(this).closest("fieldset").find(".picker:eq(0)");wc_bookings_date_picker.date_picker_init($picker),$picker.slideDown()},toggle_calendar:function(){const $picker=$(this).closest("fieldset").find(".picker:eq(0)");wc_bookings_date_picker.date_picker_init($picker),$picker.slideToggle()},input_date_keypress:function(){var $picker=$(this).closest("fieldset").find(".picker:eq(0)");$picker.data("is_range_picker_enabled")&&(clearTimeout(wc_bookings_timeout),wc_bookings_timeout=setTimeout(wc_bookings_date_picker.calc_duration($picker),800))},clear_selection:function(){$(".wc-bookings-booking-form").each(((index,form_container)=>{const form=$(form_container).closest("form");form.find("input.booking_date_year, input.booking_date_month, input.booking_date_day, input#wc_bookings_field_start_date").val("").trigger("change"),form.find(".ui-state-active").removeClass("ui-state-active"),["hour","minute"].includes(wc_bookings_booking_form.get_booking_duration_unit(form))?form.find(".wc-bookings-booking-form .block-picker").html(`<li>${wc_bookings_booking_form.sanitize_text(wc_bookings_booking_form.default_blocks_area_text)}</li>`):wc_bookings_booking_form.time_picker_reset_selected(form.find(".block-picker")),form.find(".wc-bookings-booking-cost").hide()}))},input_date_trigger:function(){var $fieldset=$(this).closest("fieldset"),$picker=$fieldset.find(".picker:eq(0)"),year=($(this).closest("form"),parseInt($fieldset.find("input.booking_date_year").val(),10)),month=parseInt($fieldset.find("input.booking_date_month").val(),10),day=parseInt($fieldset.find("input.booking_date_day").val(),10);if(year&&month&&day){var date=new Date(year,month-1,day);if($picker.datepicker("setDate",date),$picker.data("is_range_picker_enabled")){var to_year=parseInt($fieldset.find("input.booking_to_date_year").val(),10),to_month=parseInt($fieldset.find("input.booking_to_date_month").val(),10),to_day=parseInt($fieldset.find("input.booking_to_date_day").val(),10),to_date=new Date(to_year,to_month-1,to_day);!to_date||to_date<date?($fieldset.find("input.booking_to_date_year").val("").addClass("error"),$fieldset.find("input.booking_to_date_month").val("").addClass("error"),$fieldset.find("input.booking_to_date_day").val("").addClass("error")):$fieldset.find("input").removeClass("error")}$fieldset.triggerHandler("date-selected",date)}},select_date_trigger:function(date){var fieldset=$(this).closest("fieldset"),picker=fieldset.find(".picker:eq(0)"),form=$(this).closest("form"),parsed_date=date.split("-"),start_or_end_date=picker.data("start_or_end_date");if(picker.data("is_range_picker_enabled")&&start_or_end_date||(start_or_end_date="start"),picker.data("is_range_picker_enabled")&&"end"===start_or_end_date){var start_date=wc_bookings_date_picker.get_input_date(fieldset,""),moment_date=moment(date);start_date&&moment_date.isBefore(start_date)&&(start_or_end_date="start")}"end"===start_or_end_date?(picker.data("min_date",picker.data("o_min_date")),fieldset.find("input.booking_to_date_year").val(parsed_date[0]),fieldset.find("input.booking_to_date_month").val(parsed_date[1]),fieldset.find("input.booking_to_date_day").val(parsed_date[2]).trigger("change"),picker.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(picker),picker.data("start_or_end_date","start"),picker.data("is_range_picker_enabled")&&form.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==picker.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_clear_date_selection),"always_visible"!==picker.data("display")&&$(this).hide()):(picker.data("is_range_picker_enabled")&&(void 0===picker.data("o_min_date")&&picker.data("o_min_date",picker.data("min_date")),picker.data("min_date",date)),fieldset.find("input.booking_to_date_year").val(""),fieldset.find("input.booking_to_date_month").val(""),fieldset.find("input.booking_to_date_day").val(""),fieldset.find("input.booking_date_year").val(parsed_date[0]),fieldset.find("input.booking_date_month").val(parsed_date[1]),fieldset.find("input.booking_date_day").val(parsed_date[2]).trigger("change"),picker.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(picker),picker.data("start_or_end_date","end"),picker.data("is_range_picker_enabled")&&form.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===picker.data("display")||picker.data("is_range_picker_enabled")||$(this).hide()),fieldset.triggerHandler("date-selected",date,start_or_end_date),(0,utils.A)().doAction("wc_bookings_date_selected",{fieldset:fieldset.get(0),date_picker:picker.get(0)})},date_picker_init:function(element){var WC_DatePicker=new WC_Bookings_DatePicker(element);const min_date=void 0!==WC_DatePicker.get_data_attr("o_min_date")?WC_DatePicker.get_data_attr("o_min_date"):WC_DatePicker.get_data_attr("min_date");void 0===defaultDate&&(defaultDate=WC_DatePicker.get_data_attr("default_date")),WC_DatePicker.set_default_params({onSelect:wc_bookings_date_picker.select_date_trigger,minDate:min_date,maxDate:WC_DatePicker.get_data_attr("max_date"),defaultDate,closeText:WC_DatePicker.get_custom_data("closeText"),currentText:WC_DatePicker.get_custom_data("currentText"),prevText:WC_DatePicker.get_custom_data("prevText"),nextText:WC_DatePicker.get_custom_data("nextText"),monthNames:WC_DatePicker.get_custom_data("monthNames"),monthNamesShort:WC_DatePicker.get_custom_data("monthNamesShort"),dayNames:WC_DatePicker.get_custom_data("dayNames"),dayNamesShort:WC_DatePicker.get_custom_data("dayNamesShort"),dayNamesMin:WC_DatePicker.get_custom_data("dayNamesMin"),firstDay:booking_form_params.client_firstday?moment().localeData().firstDayOfWeek():WC_DatePicker.get_custom_data("firstDay"),isRTL:WC_DatePicker.get_custom_data("isRTL"),beforeShowDay:WC_DatePicker.maybe_load_from_cache.bind(WC_DatePicker),onChangeMonthYear:function(year,month){this.get_data(year,month).done((function(){element.datepicker("refresh")})),defaultDate=new Date(year,month-1,1)}.bind(WC_DatePicker)}),WC_DatePicker.create(),wc_bookings_booking_form.get_day_attributes=WC_DatePicker.maybe_load_from_cache.bind(WC_DatePicker)},refresh_datepicker:function(){var $picker=$(".wc-bookings-date-picker").find(".picker:eq(0)");$picker.datepicker("refresh"),(0,utils.A)().doAction("wc_bookings_date_picker_refreshed",{date_picker:$picker})},get_input_date:function(fieldset,where){var year=fieldset.find("input.booking_"+where+"date_year"),month=fieldset.find("input.booking_"+where+"date_month"),day=fieldset.find("input.booking_"+where+"date_day");return 0!==year.val().length&&0!==month.val().length&&0!==day.val().length?year.val()+"-"+month.val()+"-"+day.val():""},get_number_of_days:function(defaultNumberOfDays,$form,$picker,wc_bookings_booking_form){var number_of_days=defaultNumberOfDays,wcbf=wc_bookings_booking_form;$form.find("#wc_bookings_field_duration").length>0&&"minute"!=wcbf.duration_unit&&"hour"!=wcbf.duration_unit&&!$picker.data("is_range_picker_enabled")&&(number_of_days*=$form.find("#wc_bookings_field_duration").val());return(number_of_days<1||"start"===wcbf.check_availability_against)&&(number_of_days=1),number_of_days},is_blocks_bookable:function(args){for(var bookable=args.default_availability,i=0;i<args.number_of_days;i++){var the_date=new Date(args.start_date);the_date.setDate(the_date.getDate()+i);var year=the_date.getFullYear(),month=the_date.getMonth()+1,day=the_date.getDate(),day_of_week=the_date.getDay();0===day_of_week&&(day_of_week=7);var resource_args={date:the_date,default_availability:args.default_availability},resource_rules=args.availability[args.resource_id];if(!(bookable=wc_bookings_date_picker.is_resource_available_on_date(resource_args,resource_rules)))return"not_bookable_by_rules";if("automatic"===args.resources_assignment){var automatic_resource_args=$.extend({availability:args.availability,fully_booked_days:args.fully_booked_days},resource_args);bookable=wc_bookings_date_picker.has_available_resource(automatic_resource_args)}var ymdIndex=year+"-"+month+"-"+day;if(args.fully_booked_days[ymdIndex]&&(this.bookingsData.fully_booked_days[ymdIndex][0]&&0===args.resource_ids.length||0!==args.resource_id&&this.bookingsData.fully_booked_days[ymdIndex][args.resource_id])&&(bookable=!1),!bookable)break}return bookable},rrule_cache:{},is_resource_available_on_date:function(args,rules){if("object"!=typeof args||"object"!=typeof rules)return!1;const server_offset=(0,bookings_lib.f)(args.date),durationUnit=$("[data-duration-unit]").data("duration-unit");let availableMinutes;if(0===server_offset||"day"===durationUnit)availableMinutes=this.get_available_minutes_on_date_for_rule(args,rules);else{const{date:currentDate,...argsNoDate}=args,currentDayMinutes=this.get_available_minutes_on_date_for_rule({...argsNoDate,date:currentDate},rules);if(server_offset<0){const nextDayDate=new Date(currentDate);nextDayDate.setDate(currentDate.getDate()+1);const nextDayMinutes=this.get_available_minutes_on_date_for_rule({...argsNoDate,date:nextDayDate},rules).map((m=>m+1440));availableMinutes=currentDayMinutes.concat(nextDayMinutes)}else{const prevDayDate=new Date(currentDate);prevDayDate.setDate(currentDate.getDate()-1);availableMinutes=this.get_available_minutes_on_date_for_rule({...argsNoDate,date:prevDayDate},rules).map((m=>m-1440)).concat(currentDayMinutes)}availableMinutes=availableMinutes.map((m=>m+60*server_offset)),availableMinutes=availableMinutes.filter((m=>m>0&&m<1440))}return!external_default().isEmpty(availableMinutes)},get_available_minutes_on_date_for_rule:function(args,rules){var defaultAvailability=args.default_availability,year=args.date.getFullYear(),month=args.date.getMonth()+1,day=args.date.getDate(),day_of_week=args.date.getDay(),week=wc_bookings_date_picker.get_week_number(args.date);0===day_of_week&&(day_of_week=7);let minutesAvailableForDay=[];if(args.fully_booked_days&&args.fully_booked_days[year+"-"+month+"-"+day]&&args.fully_booked_days[year+"-"+month+"-"+day][args.resource_id])return minutesAvailableForDay;var minutesForADay=external_default().range(1,1440,1);return defaultAvailability&&(minutesAvailableForDay=minutesForADay),$.each(rules,(function(index,rule){var minutesAvailableForTime,type=rule.type,range=rule.range;try{switch(type){case"months":if(void 0!==range[month])return minutesAvailableForDay=range[month]?minutesForADay:[],!0;break;case"weeks":if(void 0!==range[week])return minutesAvailableForDay=range[week]?minutesForADay:[],!0;break;case"days":if(void 0!==range[day_of_week])return minutesAvailableForDay=range[day_of_week]?minutesForADay:[],!0;break;case"custom":if(void 0!==range[year][month][day])return minutesAvailableForDay=range[year][month][day]?minutesForADay:[],!0;break;case"rrule":const is_all_day=-1===range.from.indexOf(":"),current_date_sod=moment.utc(args.date).clone().startOf("day"),from_date=moment.utc(range.from),to_date=moment.utc(range.to),duration=moment.duration(to_date.diff(from_date)),rrule=rrulestr(range.rrule,{dtstart:from_date.toDate()}),cache_key=index+currentDateRange.startDate+currentDateRange.endDate;void 0===wc_bookings_date_picker.rrule_cache[cache_key]&&(wc_bookings_date_picker.rrule_cache[cache_key]=rrule.between(moment.utc(currentDateRange.startDate).subtract(duration).subtract(1,"days").toDate(),moment.utc(currentDateRange.endDate).subtract(duration).add(1,"days").toDate(),!0).map((occurrence=>new moment(occurrence)))),wc_bookings_date_picker.rrule_cache[cache_key].forEach((occurrence=>{const occurrence_sod=occurrence.clone().startOf("day"),end_occurrence=occurrence.clone().add(duration),end_occurrence_sod=end_occurrence.clone().startOf("day");if(current_date_sod.isSameOrAfter(occurrence_sod)&&current_date_sod.isBefore(end_occurrence_sod))if(is_all_day)minutesAvailableForDay=range.rule?minutesForADay:[];else if(current_date_sod.isSame(occurrence_sod)){const minutesFromStartOfDay=moment.duration(occurrence.diff(occurrence_sod)).asMinutes();minutesAvailableForTime=external_default().range(minutesFromStartOfDay,minutesFromStartOfDay+duration.asMinutes(),1),minutesAvailableForDay=range.rule?external_default().union(minutesAvailableForDay,minutesAvailableForTime):external_default().difference(minutesAvailableForDay,minutesAvailableForTime)}else current_date_sod.isAfter(occurrence_sod)&&current_date_sod.isBefore(end_occurrence_sod)?minutesAvailableForDay=range.rule?minutesForADay:[]:current_date_sod.isSame(end_occurrence_sod)&&(minutesAvailableForTime=external_default().range(1,moment.duration(end_occurrence.diff(end_occurrence_sod)).asMinutes(),1),minutesAvailableForDay=range.rule?external_default().union(minutesAvailableForDay,minutesAvailableForTime):external_default().difference(minutesAvailableForDay,minutesAvailableForTime))}));break;case"time":case"time:1":case"time:2":case"time:3":case"time:4":case"time:5":case"time:6":case"time:7":if(day_of_week===range.day||0===range.day){var fromHour=parseInt(range.from.split(":")[0]),fromMinute=parseInt(range.from.split(":")[1]),toHour=parseInt(range.to.split(":")[0]),toMinute=parseInt(range.to.split(":")[1]),fromMinuteNumber=fromMinute+60*fromHour,toMinuteNumber=toMinute+60*toHour;return minutesAvailableForTime=external_default().range(fromMinuteNumber,toMinuteNumber,1),minutesAvailableForDay=range.rule?external_default().union(minutesAvailableForDay,minutesAvailableForTime):external_default().difference(minutesAvailableForDay,minutesAvailableForTime),!0}break;case"time:range":case"custom:daterange":range=range[year][month][day];fromHour=parseInt(range.from.split(":")[0]),fromMinute=parseInt(range.from.split(":")[1]),toHour=parseInt(range.to.split(":")[0]),toMinute=parseInt(range.to.split(":")[1]),fromMinuteNumber=fromMinute+60*fromHour,toMinuteNumber=toMinute+60*toHour;minutesAvailableForTime=external_default().range(fromMinuteNumber,toMinuteNumber,1),minutesAvailableForDay=range.rule?external_default().union(minutesAvailableForDay,minutesAvailableForTime):external_default().difference(minutesAvailableForDay,minutesAvailableForTime)}}catch(err){return!0}})),minutesAvailableForDay},get_week_number:function(date){return moment(date).format("W")},has_available_resource:function(args){for(var resource_id in args.availability)if(0!==(resource_id=parseInt(resource_id,10))){var resource_rules=args.availability[resource_id];if(args.resource_id=resource_id,wc_bookings_date_picker.is_resource_available_on_date(args,resource_rules))return!0}return!1}},WC_Bookings_DatePicker=function(element){this.$picker=$(element),this.$form=this.$picker.closest("form, .cart"),this.customData={},this.opts={cache:!1},this.cache={data:{},attributes:{}},$.each(wc_bookings_booking_form,function(key,val){this.customData[key]=val}.bind(this)),$.each(booking_form_params,function(key,val){this.customData[key]=val}.bind(this)),!this.customData.cache_ajax_requests||"true"!=this.customData.cache_ajax_requests.toLowerCase()&&"false"!=this.customData.cache_ajax_requests.toLowerCase()||(this.opts.cache="true"==this.customData.cache_ajax_requests.toLowerCase()),this.customData.product_id=wc_bookings_booking_form.get_booking_product_id(element),this.customData.booking_duration=wc_bookings_booking_form.get_booking_duration(element),this.customData.booking_min_duration=wc_bookings_booking_form.get_booking_min_duration(element),this.customData.booking_max_duration=wc_bookings_booking_form.get_booking_max_duration(element),this.customData.check_availability_against=wc_bookings_booking_form.get_booking_check_availability_against(element),this.customData.default_availability=wc_bookings_booking_form.get_booking_default_availability(element),this.customData.duration_type=wc_bookings_booking_form.get_booking_duration_type(element),this.customData.booking_duration_type=wc_bookings_booking_form.get_booking_duration_type(element),this.customData.duration_unit=wc_bookings_booking_form.get_booking_duration_unit(element),this.customData.resources_assignment=wc_bookings_booking_form.get_booking_resources_assignment(element),this.customData.resource_ids=wc_bookings_booking_form.get_booking_resource_ids(element),this.$picker.length};WC_Bookings_DatePicker.prototype.create=function(){var year=parseInt(this.$form.find("input.booking_date_year").val(),10),month=parseInt(this.$form.find("input.booking_date_month").val(),10),day=parseInt(this.$form.find("input.booking_date_day").val(),10);this.$picker.empty().removeClass("hasDatepicker").datepicker(this.get_default_params()),$(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day"),year&&month&&day&&this.$picker.datepicker("setDate",new Date(year,month-1,day));var picker_month=this.$picker.datepicker("getDate").getMonth()+1,picker_year=this.$picker.datepicker("getDate").getFullYear();this.get_data(picker_year,picker_month).done((function(){wc_bookings_date_picker.refresh_datepicker()}))},WC_Bookings_DatePicker.prototype.maybe_load_from_cache=function(date){var cacheKey=date.getTime(),attributes=[!1,"1"===this.customData.default_availability?"bookable":"not-bookable",""],cachedAttributes=this.cache.attributes[cacheKey];if(cachedAttributes)cachedAttributes=[cachedAttributes.selectable,cachedAttributes.class.join(" "),cachedAttributes.title];else if(this.bookingsData){var attrs=this.getDateElementAttributes(date);attributes=[attrs.selectable,attrs.class.join(" "),attrs.title]}return cachedAttributes||attributes},WC_Bookings_DatePicker.prototype.get_default_params=function(){return this.defaultParams||{}},WC_Bookings_DatePicker.prototype.set_default_params=function(params){var _defaultParams={showWeek:!1,showOn:!1,numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,gotoCurrent:!0,dateFormat:$.datepicker.ISO_8601};if("object"!=typeof params)throw new Error("Cannot set params with typeof "+typeof params);this.defaultParams=$.extend(_defaultParams,params)||{}},WC_Bookings_DatePicker.prototype.get_data=function(year,month){var get_date_range=function(startDate){startDate||(startDate=new Date([year,month,"01"].join("/")));var range=this.get_number_of_days_in_month(month);return this.get_padded_date_range(startDate,range)}.bind(this),deferred=$.Deferred(),dateRange=get_date_range(),cacheKey=dateRange.startDate.getTime()+"-"+dateRange.endDate.getTime();if(this.opts.cache&&this.cache.data[cacheKey])deferred.resolveWith(this,[dateRange,this.cache.data[cacheKey]]);else{var resource_id=parseInt(this.$form.find("select#wc_bookings_field_resource").val(),10)||0,params={product_id:this.get_custom_data("product_id"),"wc-ajax":"wc_bookings_find_booked_day_blocks",security:this.$form.data("nonce"),resource_id};this.$picker.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),booking_form_params.timezone_conversion&&(params.timezone_offset=(0,bookings_lib.f)(dateRange.startDate),$("#timezone_offset").val(params.timezone_offset)),params.min_date=moment(dateRange.startDate).format("YYYY-MM-DD"),params.max_date=moment(dateRange.endDate).format("YYYY-MM-DD"),$("#min_date").val(params.min_date),$("#max_date").val(params.max_date),$.ajax({context:this,url:wc_bookings_date_picker_args.ajax_url,method:"GET",data:params}).done(function(data){if("old_availability"in data&&data.old_availability){if(0===$("#old_availability_served").length){let old_availability=document.createElement("p");old_availability.setAttribute("id","old_availability_served"),old_availability.textContent=booking_form_params.i18n_old_availability,$(old_availability).insertBefore("#wc-bookings-booking-form")}}else $("#old_availability_served").remove();this.bookingsData=this.bookingsData||{},$.each(data,function(key,val){if(Array.isArray(val)||"object"==typeof val){var emptyType=Array.isArray(val)?[]:{};this.bookingsData[key]=this.bookingsData[key]||emptyType,$.extend(this.bookingsData[key],val)}else this.bookingsData[key]=val}.bind(this)),wc_bookings_booking_form.wc_bookings_date_picker.bookingsData=this.bookingsData,this.cache.data[cacheKey]=data,year||month||!this.bookingsData.min_date||(dateRange=get_date_range(this.get_default_date(this.bookingsData.min_date))),deferred.resolveWith(this,[dateRange,data]),this.$picker.unblock()}.bind(this))}return deferred},WC_Bookings_DatePicker.prototype.get_default_date=function(minBookableDate){var defaultDate,defaultDateFromData=this.$picker.data("default_date").split("-");defaultDateFromData[2]="31";var modifier=1;if(defaultDate=3!==defaultDateFromData.length?new Date:new Date(defaultDateFromData),minBookableDate){switch(minBookableDate.unit){case"month":modifier=30;break;case"week":modifier=7}modifier*=minBookableDate.value,defaultDate.setDate(defaultDate.getDate()+modifier)}return defaultDate},WC_Bookings_DatePicker.prototype.get_number_of_days_in_month=function(month){var currentDate=this.get_default_date();return month=month||currentDate.getMonth()+1,new Date(currentDate.getFullYear(),month,0).getDate()},WC_Bookings_DatePicker.prototype.get_custom_data=function(key){if(key)return this.customData[key]||null},WC_Bookings_DatePicker.prototype.get_data_attr=function(attr){if(attr)return this.$picker.data(attr)},WC_Bookings_DatePicker.prototype.get_padded_date_range=function(date,rangeInDays,padInDays){date=date||this.get_default_date(),rangeInDays=rangeInDays||30,padInDays=padInDays||7;var currentDate=new Date,isCurrentDayToday=date<currentDate,startDate=new Date(date.setDate(isCurrentDayToday?currentDate.getDate():"01")),endDate=new Date(startDate.getTime());return startDate.setDate(startDate.getDate()-(isCurrentDayToday?0:padInDays)),endDate.setDate(endDate.getDate()+(rangeInDays+padInDays)),startDate<currentDate&&(startDate=currentDate),{startDate,endDate}},WC_Bookings_DatePicker.prototype.getDateElementAttributes=function(date){var attributes={class:[],title:"",selectable:!0},moment_date=moment(date),resource_id=this.$form.find("select#wc_bookings_field_resource").val()>0?this.$form.find("select#wc_bookings_field_resource").val():0,year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate(),day_of_week=date.getDay(),ymdIndex=year+"-"+month+"-"+day,today=new Date;this.bookingsData.unavailable_days&&this.bookingsData.unavailable_days[ymdIndex]&&this.bookingsData.unavailable_days[ymdIndex][resource_id]&&(attributes.title=booking_form_params.i18n_date_unavailable,attributes.selectable=!1,attributes.class.push("not_bookable")),this.bookingsData.buffer_days&&this.bookingsData.buffer_days[ymdIndex]&&(this.bookingsData.buffer_days[ymdIndex][0]||this.bookingsData.buffer_days[ymdIndex][resource_id]||"automatic"===this.customData.resources_assignment&&Object.keys(this.bookingsData.buffer_days[ymdIndex]).length===this.customData.resource_ids.length)&&(attributes.title=booking_form_params.i18n_date_unavailable,attributes.selectable=!1,attributes.class.push("not_bookable")),this.bookingsData.restricted_days&&void 0===this.bookingsData.restricted_days[day_of_week]&&(attributes.title=booking_form_params.i18n_date_unavailable,attributes.selectable=!1,attributes.class.push("not_bookable")),moment_date.isBefore(today,"day")&&(attributes.title=booking_form_params.i18n_date_unavailable,attributes.selectable=!1,attributes.class.push("not_bookable"));var number_of_days=wc_bookings_date_picker.get_number_of_days(this.customData.booking_duration,this.$form,this.$picker,wc_bookings_booking_form),block_args={start_date:date,number_of_days,fully_booked_days:this.bookingsData.fully_booked_days,availability:this.bookingsData.availability_rules,default_availability:this.customData.default_availability,resource_id,resource_ids:this.customData.resource_ids,resources_assignment:this.customData.resources_assignment},bookable=wc_bookings_date_picker.is_blocks_bookable(block_args);if("not_bookable_by_rules"===bookable&&(attributes.class.push("not_bookable_by_rules"),bookable=!1),this.bookingsData.fully_booked_days[ymdIndex]){if(this.bookingsData.fully_booked_days[ymdIndex][0]&&0===this.customData.resource_ids.length||0!==resource_id&&this.bookingsData.fully_booked_days[ymdIndex][resource_id])return attributes.title=booking_form_params.i18n_date_fully_booked,attributes.selectable=!1,attributes.class.push("fully_booked"),attributes;"automatic"===this.customData.resources_assignment&&attributes.class.push("partial_booked")}this.bookingsData.partially_booked_days&&this.bookingsData.partially_booked_days[ymdIndex]&&("automatic"===this.customData.resources_assignment||this.bookingsData.partially_booked_days[ymdIndex][0]||this.bookingsData.partially_booked_days[ymdIndex][resource_id])&&attributes.class.push("partial_booked");var end_date,fieldset=this.$picker.closest("fieldset"),start_date=$.datepicker.parseDate($.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(fieldset,""));this.$picker.data("is_range_picker_enabled")?end_date=$.datepicker.parseDate($.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(fieldset,"to_")):start_date&&number_of_days>1&&(end_date=new Date(start_date)).setDate(end_date.getDate()+(number_of_days-1));const inRange=start_date&&(moment_date.isSame(start_date,"day")||end_date&&moment_date.isSameOrAfter(start_date,"day")&&moment_date.isSameOrBefore(end_date,"day"));return inRange&&(attributes.class.push("bookable-range"),moment_date.isSame(start_date,"day")?attributes.class.push("selection-start-date"):moment_date.isSame(end_date,"day")&&attributes.class.push("selection-end-date")),bookable?(attributes.class.indexOf("partial_booked")>-1?attributes.title=booking_form_params.i18n_date_partially_booked:""===attributes.title&&(attributes.title=booking_form_params.i18n_date_available),inRange||attributes.class.push("bookable")):(attributes.title=booking_form_params.i18n_date_unavailable,attributes.selectable=bookable,0===resource_id?attributes.class.push([this.bookingsData.fully_booked_days[ymdIndex]?"fully_booked":"not_bookable"]):this.bookingsData.fully_booked_days[ymdIndex]&&this.bookingsData.fully_booked_days[ymdIndex][resource_id]&&attributes.class.push([this.bookingsData.fully_booked_days[ymdIndex][resource_id]?"fully_booked":"not_bookable"])),attributes=(0,utils.A)().applyFilters("wc_bookings_date_picker_get_day_attributes",attributes,{booking_data:this.bookingsData,custom_data:this.customData,date_picker:this.$picker,resource_id,date})},moment.locale(wc_bookings_locale),wc_bookings_date_picker.init(),wc_bookings_booking_form.wc_bookings_date_picker=wc_bookings_date_picker}))})(),(()=>{var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428);__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__)()(document).ready((function($){var startSel=null,endSel=null;$(".wc-bookings-booking-form").closest("form").each(((index,form)=>{const $form=$(form);$form.find(".picker").data("is_range_picker_enabled")&&$form.find("p.wc_bookings_field_duration").hide()})),$(".block-picker").on("click","a",(function(){const bookingform=$(this).closest("form"),$picker=bookingform.find(".picker");if(!bookingform.find('[name="wc_bookings_field_start_date_yearmonth"]').length)return!1;var range,value=$(this).data("value"),target=$(this).closest("div").find("input");value=$(this).data("value");!function(block_picker,value){var submit_button=block_picker.closest("form").find(".wc-bookings-booking-form-button");if(void 0===value)return void submit_button.addClass("disabled");var selected_block=block_picker.find('[data-value="'+value+'"]');if(void 0===selected_block.data("value"))return void submit_button.addClass("disabled");block_picker.closest("ul").find("a").removeClass("selected"),selected_block.addClass("selected"),submit_button.removeClass("disabled")}($(this).closest("ul"),value),$picker.data("is_range_picker_enabled")?($(this).parent().siblings().children("a").removeClass("selected"),$("#wc_bookings_field_duration").val(1),startSel&&endSel?(startSel=$(this).parent(),endSel=null):startSel?(value=startSel.find("a").data("value"),endSel=$(this).parent(),(range=startSel.is(endSel)?startSel:(range=startSel.nextUntil(endSel).addBack()).add(range.last().next())).children("a").addClass("selected"),$("#wc_bookings_field_duration").val(range.length)):startSel=$(this).parent(),target.val(value).trigger("change")):target.val(value).trigger("change")}));var max_width=0,max_height=0;$(".block-picker a").each((function(){var width=$(this).width(),height=$(this).height();width>max_width&&(max_width=width),height>max_height&&(max_height=height)})),$(".block-picker a").width(max_width),$(".block-picker a").height(max_height)}))})(),(()=>{var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(428),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__),_bookings_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).ready((function($){var xhr,local_timezone=moment.tz.guess()||booking_form_params.server_timezone;function set_selected_time(block_picker,value){var submit_button=block_picker.closest("form").find(".wc-bookings-booking-form-button");if(void 0!==value){var selected_block=block_picker.find('[data-value="'+value+'"]');if(void 0!==selected_block.data("value"))block_picker.closest("div").find("input").val(value).trigger("change"),block_picker.closest("ul").find("a").removeClass("selected"),selected_block.addClass("selected"),submit_button.removeClass("disabled");else submit_button.addClass("disabled")}else submit_button.addClass("disabled")}function time_picker_reset_selected(block_picker){block_picker.closest("ul").find("a").removeClass("selected")}function show_available_time_blocks(element){var $form=$(element).closest("form"),fieldset=$(element).closest("div").find("fieldset"),block_picker=$(element).closest("div").find(".block-picker"),selected_block=block_picker.find(".selected"),year_str=fieldset.find("input.booking_date_year").val(),year=parseInt(year_str,10),month_str=fieldset.find("input.booking_date_month").val(),month=parseInt(month_str,10),day_str=fieldset.find("input.booking_date_day").val(),day=parseInt(day_str,10),date_str=year_str+"-"+month_str+"-"+day_str;if(year&&month&&day){block_picker.closest("div").find("input").val("").trigger("change"),block_picker.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),$form.find(".wc-bookings-booking-cost").html("").hide(),xhr&&xhr.abort();var form_val=$form.serialize(),server_offset=(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.f)(date_str);server_offset<0?form_val+="&get_next_day=true":server_offset>0&&(form_val+="&get_prev_day=true"),xhr=$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_get_blocks",form:form_val},success:function(code){var max_width,max_height;block_picker.html(code),max_width=0,max_height=0,$(".block-picker a").each((function(){var width=$(this).width(),height=$(this).height();width>max_width&&(max_width=width),height>max_height&&(max_height=height)})),$(".block-picker a").width(max_width),$(".block-picker a").height(max_height),function(date_str,element){if(!booking_form_params.timezone_conversion)return;const booking_duration_type=wc_bookings_booking_form.get_booking_duration_type(element),booking_duration_unit=wc_bookings_booking_form.get_booking_duration_unit(element);var from=moment.tz(date_str,local_timezone),to=moment(from),selector=".block-picker .block a";to.add(1,"days"),"customer"===booking_duration_type&&["hour","minute"].includes(booking_duration_unit)&&(selector=".block-picker #wc-bookings-form-start-time > option");$(selector).each((function(){if(".block-picker #wc-bookings-form-start-time > option"===selector)var block_time=$(this).val();else block_time=$(this).attr("data-value");if(void 0===block_time||"0"==block_time)return!0;var server_offset=(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.f)(date_str),server_local_time=moment.tz(block_time,booking_form_params.server_timezone),client_local_time=moment.tz(block_time,booking_form_params.server_timezone);if(client_local_time.add(server_offset,"hours"),server_local_time.isBetween(from,to,null,"[)")){if(".block-picker #wc-bookings-form-start-time > option"===selector){moment($(this).val()).unix()<=moment().unix()?$(this).remove():$(this).text(server_local_time)}$(this).text(client_local_time.format(booking_form_params.server_time_format)),$(this).data("remaining")&&(".block-picker #wc-bookings-form-start-time > option"===selector?$(this).append(" ("+$(this).data("remaining")+")"):$(this).append(' <small class="booking-spaces-left">('+$(this).data("remaining")+")</small>"))}else".block-picker #wc-bookings-form-start-time > option"===selector?$(this).remove():$(this).parent().remove()}))}(date_str,$(element)),block_picker.closest("div").unblock(),set_selected_time(block_picker,selected_block.data("value")),$(".woocommerce-error.wc-bookings-notice").slideUp()},error:function(jqXHR,exception){"abort"!==exception&&((0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.u)(),$(".blockOverlay").remove(),wc_bookings_booking_form.wc_bookings_date_picker.clear_selection(),wc_bookings_booking_form.wc_bookings_date_picker.refresh_datepicker())},dataType:"html"})}}booking_form_params.timezone_conversion&&($(".wc-bookings-date-picker-timezone").text(local_timezone.replace("_"," ")),$('[name="wc_bookings_field_start_date_local_timezone"]').val(local_timezone)),$(".block-picker").on("click","a",(function(){if($(this).closest("form").find('[name="wc_bookings_field_start_date_yearmonth"]').length)return!1;var value=$(this).data("value");return set_selected_time($(this).closest("ul"),value),!1})),wc_bookings_booking_form.time_picker_reset_selected=time_picker_reset_selected,$(".wc-bookings-booking-form").on("change","#wc-bookings-form-start-time",(function(){var value=$(this).val(),bookingForm=$(this).closest("form"),id=$(this).parents(".wc-bookings-start-time-container").data("productId"),blocks=$(this).parents(".wc-bookings-start-time-container").data("blocks"),formField=$(this).parents(".form-field").eq(0);if($("#wc-bookings-form-end-time").attr("disabled","disabled"),$("#wc-bookings-form-end-time").css("opacity","0.5"),$(this).closest("form").find(".wc-bookings-booking-cost").html("").hide(),"0"===value)return $(this).closest("form").find(".wc-bookings-booking-form-button").addClass("disabled"),!1;bookingForm.find(".wc-bookings-booking-form-button").addClass("disabled");var resource_id=bookingForm.find("#wc_bookings_field_resource").val(),year_str=bookingForm.find("input.booking_date_year").val(),year=parseInt(year_str,10),month_str=bookingForm.find("input.booking_date_month").val(),month=parseInt(month_str,10),day_str=bookingForm.find("input.booking_date_day").val(),day=parseInt(day_str,10),person_qty=bookingForm.find("#wc_bookings_field_persons").val(),date_str=year_str+"-"+month_str+"-"+day_str;return year&&month&&day?(xhr=$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_get_end_time_html",security:booking_form_params.nonce.get_end_time_html,start_date_time:value,product_id:id,blocks,resource_id,person_qty},success:function(response){bookingForm.find(".wc-bookings-end-time-container").replaceWith(response),function(date_str){if(!booking_form_params.timezone_conversion)return;var from=moment.tz(date_str,local_timezone),to=moment(from),element=".block-picker #wc-bookings-form-end-time > option";to.add(1,"days"),$(element).each((function(){var block_time=$(this).data("value");if(void 0===block_time||"0"==block_time)return!0;var server_offset=(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.f)(date_str),client_local_time=moment.tz(block_time,booking_form_params.server_timezone),duration_display=$(this).data("durationDisplay");client_local_time.add(server_offset,"hours"),$(this).text(client_local_time.format(booking_form_params.server_time_format)+duration_display)}))}(date_str),formField.find("input.required_for_calculation").val(value)},dataType:"html"}),!1):void 0})),$(".wc-bookings-booking-form").on("change","#wc-bookings-form-end-time",(function(){$(".wc-bookings-booking-cost").html("").hide();var value=$(this).val(),block_picker=$(this);$(this).parents(".wc-bookings-booking-form").find(".wc_bookings_field_duration").val(value);var submit_button=block_picker.closest("form").find(".wc-bookings-booking-form-button");void 0!==value&&"0"!==value&&"0"!==$(this).parents(".wc-bookings-booking-form").find("#wc-bookings-form-start-time").val()?(block_picker.parents(".form-field").eq(0).find("input.required_for_calculation").trigger("change"),submit_button.removeClass("disabled")):submit_button.addClass("disabled")})),$(".wc_bookings_field_duration").on("change",(function(){["hour","minute"].includes(wc_bookings_booking_form.get_booking_duration_unit($(this)))&&show_available_time_blocks(this)})),$("#wc_bookings_field_resource").on("change",(function(){const duration_unit=wc_bookings_booking_form.get_booking_duration_unit($(this));if("month"===duration_unit)!function(element){var form_val=$(element).closest("form").serialize(),block_picker=$(element).closest("div").find(".block-picker");block_picker.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show();$.ajax({type:"POST",url:booking_form_params.ajax_url,data:{action:"wc_bookings_get_booking_blocks",form:form_val,security:booking_form_params.nonce.show_available_month_blocks},success:function(result){if(!(result=JSON.parse(result)).success)return alert(result.data),!1;block_picker.closest("div").unblock(),$(".block-picker").html(result.data)},error:function(jqXHR,exception){"abort"!==exception&&(0,_bookings_lib__WEBPACK_IMPORTED_MODULE_1__.u)()},dataType:"html"})}(this);else if(!["hour","minute"].includes(duration_unit))return;time_picker_reset_selected($(".wc-bookings-booking-form").find(".block-picker"))})),$(".wc-bookings-booking-form fieldset").on("date-selected",(function(){$(".wc_bookings_field_duration").val(1),["hour","minute"].includes(wc_bookings_booking_form.get_booking_duration_unit($(this)))&&show_available_time_blocks(this)}))}))})()})();
//# sourceMappingURL=frontend.js.map